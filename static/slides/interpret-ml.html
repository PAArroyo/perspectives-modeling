<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Interpreting Machine Learning Algorithms</title>
    <meta charset="utf-8" />
    <meta name="author" content="MACS 30100   University of Chicago" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/lucy-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/plotly-binding/plotly.js"></script>
    <script src="libs/typedarray/typedarray.min.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main/plotly-latest.min.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Interpreting Machine Learning Algorithms
### <a href="https://model.uchicago.edu">MACS 30100</a> <br /> University of Chicago

---




`$$\newcommand{\E}{\mathrm{E}} \newcommand{\Var}{\mathrm{Var}} \newcommand{\Cov}{\mathrm{Cov}} \newcommand{\se}{\text{se}} \newcommand{\Lagr}{\mathcal{L}} \newcommand{\lagr}{\mathcal{l}}$$`

---

# Statistical background

* Interpreting regression coefficients

    `$$Y = \beta_0 + \beta_1 X_1 + \ldots \beta_p X_p + \epsilon$$`

* Generalizations of regression models
* Substantive interpretations

---

# Marginal effects

`$$\frac{\partial Y}{\partial X}$$`

--

$$
`\begin{align}
Y &amp;= \beta_0 + \beta_1 X_1 \\
\frac{\partial Y}{\partial X_1} &amp;= \beta_1
\end{align}`
$$

--

$$
`\begin{align}
Y &amp;= \beta_0 + \beta_1 X_1 + \beta_2 X_2 \\
\frac{\partial Y}{\partial X_1} &amp;= \beta_1 \\
\frac{\partial Y}{\partial X_2} &amp;= \beta_2 \\
\end{align}`
$$

---

# Marginal effects

$$
`\begin{aligned}
Y &amp;= \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_3 X_1 X_2 \\
\frac{\partial Y}{\partial X_1} &amp;= \beta_1 + \beta_3 X_2 \\
\frac{\partial Y}{\partial X_2} &amp;= \beta_2 + \beta_3 X_1
\end{aligned}`
$$

--

$$
`\begin{aligned}
Y &amp;= \beta_0 + \beta_1 X_1 + \beta_2 X_1^2 + \beta_3 X_2 \\
\frac{\partial Y}{\partial X_1} &amp;= \beta_1 + 2\beta_2 X_1 \\
\frac{\partial Y}{\partial X_2} &amp;= \beta_3
\end{aligned}`
$$

---

# Types of marginal effects

1. Marginal effects at representative values (MERs)
1. Marginal effects at means (MEMs)
1. Average marginal effects (AMEs)

---

# Logistic regression marginal effects




```
## 
## Call:
## glm(formula = Survived ~ Age + Sex, family = binomial, data = titanic)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.7405  -0.6885  -0.6558   0.7533   1.8989  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.277273   0.230169   5.549 2.87e-08 ***
## Age         -0.005426   0.006310  -0.860     0.39    
## Sexmale     -2.465920   0.185384 -13.302  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 964.52  on 713  degrees of freedom
## Residual deviance: 749.96  on 711  degrees of freedom
## AIC: 755.96
## 
## Number of Fisher Scoring iterations: 4
```

---

# Average marginal effects

## Link function


```
##        Age Sexmale
##  -0.005426  -2.466
```

--

## Response variable


```
##         Age Sexmale
##  -0.0009278 -0.5468
```

---

# Marginal effects at representative cases (MERs)


```
##  at(Sex)        Age Sexfemale
##     male -0.0008872    0.5468
##   female -0.0010080    0.5468
```

--

* AMEs calculated separately for men and women


```
## $female
##        Age Sexmale
##  -0.001003  -0.547
## 
## $male
##         Age Sexmale
##  -0.0008843 -0.5466
```

---

# Marginal effects plots



&lt;img src="interpret-ml_files/figure-html/age-margin-effect2-1.png" width="864" /&gt;

---

# Interaction models


```
## 
## Call:
## glm(formula = Survived ~ Age * Fare, family = binomial, data = titanic)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.2517  -0.9381  -0.7988   1.2004   1.9000  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept) -0.1116164  0.2587950  -0.431  0.66626   
## Age         -0.0281442  0.0085913  -3.276  0.00105 **
## Fare         0.0075141  0.0060702   1.238  0.21576   
## Age:Fare     0.0003100  0.0001849   1.677  0.09351 . 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 964.52  on 713  degrees of freedom
## Residual deviance: 888.52  on 710  degrees of freedom
## AIC: 896.52
## 
## Number of Fisher Scoring iterations: 5
```

---

# Interaction models

.pull-left[

&lt;img src="interpret-ml_files/figure-html/age-fare-pred-1.png" width="504" /&gt;

]

.pull-right[

&lt;img src="interpret-ml_files/figure-html/age-fare-me-1.png" width="504" /&gt;

]

---

# Interaction models

.pull-left[

&lt;img src="interpret-ml_files/figure-html/age-fare-fare-1.png" width="504" /&gt;

]

.pull-right[


&lt;img src="interpret-ml_files/figure-html/age-fare-fare2-1.png" width="504" /&gt;

]

---

# Three-dimensional models

.pull-left[

&lt;img src="interpret-ml_files/figure-html/age-fare-joint-1.png" width="504" /&gt;
]

.pull-right[

&lt;img src="interpret-ml_files/figure-html/age-fare-joint2-1.png" width="504" /&gt;

]

---

# Three-dimensional models

.center[

<div id="htmlwidget-3dc6a50ab8afd53db897" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-3dc6a50ab8afd53db897">{"x":{"visdat":{"a092356f7ccd":["function () ","plotlyVisDat"]},"cur_data":"a092356f7ccd","attrs":{"a092356f7ccd":{"x":{},"y":{},"z":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Predicted probability of survival","scene":{"xaxis":{"title":"Age"},"yaxis":{"title":"Fare"},"zaxis":{"title":"Predicted probability of survival"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"colorbar":{"title":"outcome","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(68,1,84,1)"],["0.208086941012205","rgba(64,70,135,1)"],["0.347527293299459","rgba(48,107,142,1)"],["0.444287735246136","rgba(38,130,142,1)"],["0.565757262758075","rgba(34,160,136,1)"],["0.654796219573462","rgba(51,180,123,1)"],["0.722455830452785","rgba(86,194,106,1)"],["0.801637075558797","rgba(126,209,81,1)"],["0.850040389125327","rgba(157,216,63,1)"],["0.895781657727389","rgba(185,223,44,1)"],["0.923572658503474","rgba(204,225,42,1)"],["0.948263617793309","rgba(220,227,40,1)"],["0.96261591625101","rgba(229,228,40,1)"],["0.974599522712495","rgba(237,229,39,1)"],["0.982330106266701","rgba(242,230,38,1)"],["0.988558293939112","rgba(246,230,38,1)"],["0.993136408559523","rgba(249,231,37,1)"],["0.995802760091792","rgba(250,231,37,1)"],["0.997547967831102","rgba(251,231,37,1)"],["0.998790143185688","rgba(252,231,37,1)"],["0.999400680721291","rgba(253,231,37,1)"],["0.999758868757262","rgba(253,231,37,1)"],["0.9999126198646","rgba(253,231,37,1)"],["0.999979865000705","rgba(253,231,37,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"x":[0.42,3.73583333333333,7.05166666666667,10.3675,13.6833333333333,16.9991666666667,20.315,23.6308333333333,26.9466666666667,30.2625,33.5783333333333,36.8941666666667,40.21,43.5258333333333,46.8416666666667,50.1575,53.4733333333333,56.7891666666667,60.105,63.4208333333333,66.7366666666667,70.0525,73.3683333333333,76.6841666666667,80],"y":[0,21.34705,42.6941,64.04115,85.3882,106.73525,128.0823,149.42935,170.7764,192.12345,213.4705,234.81755,256.1646,277.51165,298.8587,320.20575,341.5528,362.89985,384.2469,405.59395,426.941,448.28805,469.6351,490.98215,512.3292],"z":[[0.469179872486983,0.509935357893726,0.550559195975575,0.590519650043615,0.629319287733342,0.666518682863146,0.701754152233812,0.734748271589505,0.765313024473644,0.793346400716528,0.81882391502422,0.841786805091566,0.862328632167098,0.880581741948839,0.896704662795085,0.910871118616848,0.92326098149141,0.934053217221472,0.943420692874971,0.951526609352214,0.958522277050219,0.964545950083727,0.969722457819058,0.974163408933836,0.977967783958385],[0.44602156545052,0.492093163832154,0.538299452324765,0.583856958124277,0.62802549368043,0.670154498719996,0.709717494044541,0.746331364970458,0.779760174552777,0.809905738976163,0.836788751115027,0.860524695483469,0.881298372522977,0.899339913573617,0.914904083148799,0.928253690607907,0.939647199055357,0.949330151390419,0.957529795302202,0.964452218719602,0.970281342383023,0.975179206249255,0.979287096071234,0.982727164177334,0.985604293086125],[0.423095234348242,0.474271088839172,0.525993209514688,0.577163482462041,0.626729862316801,0.673770076579865,0.717553788857997,0.757575533702217,0.793557871568272,0.825430140111128,0.853291413636191,0.877366673944455,0.897963558982104,0.915434524829192,0.930146768186502,0.942460336120676,0.952713644770833,0.961215050192865,0.968238979327918,0.974025253291489,0.97878047690645,0.982680636174351,0.985874289722491,0.988485940574261,0.990619327300476],[0.400495401435289,0.456514324643467,0.513655308084742,0.57044155458889,0.625432409666567,0.67736510266933,0.72526043072948,0.768475906358259,0.806705440603247,0.839937274883183,0.868387898999244,0.892429169069892,0.912521269848423,0.929158464043859,0.942829740659244,0.953993316386112,0.963062395322373,0.97039920050741,0.976314558527375,0.981070863462209,0.984886833568216,0.987942987156381,0.990387163603045,0.992339702736152,0.993898089702511],[0.37831112832049,0.438867401962647,0.501300742460725,0.563693547478172,0.624133151854944,0.68093927226913,0.732835086622849,0.779029114974592,0.819206451683317,0.853452873288919,0.8821454964673,0.905840156264612,0.925175076257091,0.940799210172697,0.953325470201577,0.963304684510172,0.971214723224114,0.977459572189902,0.982374213584941,0.986232375805978,0.989255250133516,0.991620049686443,0.993467819948926,0.994910250053416,0.996035435124552],[0.356624697662332,0.421373748005292,0.488944588308095,0.556921872322673,0.622832105107573,0.684492289763441,0.740275693384183,0.789233223186422,0.831068284073812,0.866009280198881,0.894639476146707,0.917733305746903,0.936126628344249,0.950628776614551,0.961972036418894,0.970789213316911,0.977609619859202,0.982865641724696,0.986904368350848,0.990000814599106,0.992370769748748,0.994182311286317,0.995565628932335,0.996621142136598,0.997426061132942],[0.335510523483156,0.404075267369036,0.476601929045129,0.550128975195032,0.621529285749832,0.688023868681472,0.74758045376352,0.799087646458853,0.842301678432291,0.877644073497974,0.905950157856704,0.928243252175936,0.945569587875221,0.958897567534819,0.969068777210583,0.97678395767652,0.982609274190067,0.986992380349536,0.990281707486329,0.992745353527188,0.994587863685081,0.99596432176459,0.996991766772208,0.997758222901083,0.998329723791997],[0.315034315250449,0.38701195473058,0.464287782275787,0.543317333599926,0.620224710206133,0.69153373173148,0.754747831552284,0.808593066119807,0.852920288226942,0.888398778194266,0.916160402378451,0.937501942937941,0.953685580242011,0.965831261797958,0.974875720919544,0.981571792426861,0.986507939427309,0.990135186853451,0.992794396546986,0.994740583689408,0.996163149692112,0.997202022576592,0.997960184247651,0.998513214848285,0.998916471736188],[0.295252507475038,0.370221546598185,0.45201702690353,0.536489452928084,0.618918394999217,0.695021610827282,0.761776545906753,0.817751338836006,0.86294024013939,0.898317699238496,0.925353532931781,0.945635961347642,0.960641787172799,0.971629896033844,0.979615416979015,0.985387005719816,0.98954190133688,0.992524402642671,0.994660926141942,0.996189176344248,0.997281177729585,0.998060872395505,0.998617278875954,0.999014189724138,0.999297247276121],[0.276211953627721,0.353739218050953,0.439804331675237,0.529647862822649,0.617610356749424,0.698487247107377,0.76866556492987,0.826565403078299,0.872379711416101,0.907446886312755,0.933611669952445,0.952764688963994,0.966589806510371,0.97646844393895,0.983476124715563,0.98842166800901,0.991899218051515,0.994338269375354,0.996045878187842,0.99723989249217,0.99807405104132,0.998656450183932,0.999062899547348,0.999346470715963,0.999544271008347],[0.257949871556882,0.337597328891658,0.427664085879189,0.522795113468921,0.616300612173962,0.701930390946766,0.775414098584799,0.835039184006765,0.881258530404597,0.915833235889161,0.941014445636221,0.958999160720174,0.971665443334033,0.980498335986309,0.986615629665144,0.990831989170879,0.993728549339234,0.995713923015581,0.997072631954612,0.998001487516636,0.998636019856599,0.999069274594237,0.999364997777817,0.999566800368695,0.999704489414519],[0.240494017962267,0.321825222064915,0.41561033288333,0.515933771818902,0.614989178086163,0.705350801961611,0.782021591014019,0.843177498074623,0.889597804877984,0.92352372952171,0.947638055024593,0.964441470753108,0.975989149803307,0.98384950433855,0.989165206173263,0.992744224699843,0.99514679940855,0.996756418848649,0.997833351909308,0.998553240896256,0.999034171587273,0.99935533483288,0.999569748880122,0.999712869832688,0.999808391419226],[0.223863062252223,0.306449075613442,0.403656707150825,0.509066417762438,0.613676071394725,0.708748249006836,0.78848771233744,0.850985958508545,0.897419581263078,0.930564802568091,0.953554596165239,0.969184599896624,0.979666887561994,0.986632658399412,0.991233431563142,0.994259922620971,0.996245532695054,0.997545974975502,0.998396705390727,0.998952824918577,0.99931618068125,0.999553513200705,0.999708498976345,0.999809695888731,0.999875765849184],[0.208067125435286,0.291491807930247,0.391816375310564,0.502195640257018,0.612361309102944,0.712122510166808,0.794812350002047,0.858470882676298,0.904746536575122,0.937001834198783,0.958831651646505,0.97331255334408,0.982791239366496,0.988941592799766,0.99290968873325,0.99546044608161,0.997096245677998,0.998143694405863,0.99881375460907,0.999242130589701,0.999515886759793,0.999690787838287,0.999802512906325,0.999873874374464,0.999919451631747],[0.193108447494338,0.276973034673144,0.380101981792183,0.495324033428552,0.611044908307937,0.715473372739247,0.800995599754023,0.865639202205174,0.911601703741539,0.942878747439336,0.963532066296942,0.976900715879961,0.985442642322654,0.990855402556884,0.994267282146774,0.99641078933621,0.997754632720628,0.998596034026695,0.999122416282032,0.9994515529434,0.999657289659104,0.999785865732014,0.99986620983757,0.999916411006823,0.99994777651791],[0.178982146704266,0.26290907448735,0.368525599460217,0.488454192655567,0.609726886199853,0.718800633212492,0.807037756302283,0.872498376570002,0.918008230071541,0.948237706887829,0.967713880003657,0.980016350330773,0.987690652575405,0.992440532939365,0.995366148072337,0.997162747868117,0.998263999306237,0.998938265976355,0.999350816226203,0.999603128519603,0.999757400717572,0.999851712999994,0.999909364002377,0.999944602696684,0.99996614127668],[0.165677036200199,0.249312999666386,0.357098685601898,0.481588710649393,0.608407260061069,0.722104097236283,0.812939303739767,0.879056310730722,0.923989167891202,0.953118901433743,0.97143037962236,0.982719181358014,0.989595180708676,0.993752628222363,0.996255173154724,0.997757521679352,0.998657970365268,0.999197142243246,0.99951980136911,0.999712824841445,0.999828272791529,0.999897314011205,0.999938599598387,0.999963286649152,0.999978048079236],[0.153176466337382,0.236194727090999,0.345832043539843,0.4747301735429,0.607086047265386,0.725383579586218,0.818700905786017,0.885321277268919,0.929567295801221,0.957560399575161,0.974730239236589,0.985062020886317,0.991207659393051,0.994838167883243,0.996974153326152,0.998227834507787,0.998962625848708,0.99939293661457,0.999644814634683,0.999792207114038,0.999878443072364,0.999928892860409,0.999958405337151,0.999975669183233,0.999985767779757],[0.141459165548425,0.223561144227252,0.334735790056324,0.467881157000319,0.605763265277198,0.728638904122045,0.824323395911256,0.891301843352011,0.934764968609148,0.96159806561216,0.97765772317294,0.987091403207336,0.992572121150096,0.995735894172172,0.997555433122598,0.998599647516358,0.999198176716287,0.999541004192976,0.999737290929321,0.999849649475391,0.999913957315347,0.999950760797528,0.999971822579684,0.999983875452432,0.999990772764473],[0.130500057072217,0.211416264632908,0.323819328731816,0.461044222360558,0.604438931650668,0.731869903739951,0.829807767398762,0.897006802744306,0.939603993718826,0.965265525939231,0.980252930944119,0.988848207246795,0.993726175686653,0.996478044038608,0.998025267436791,0.998893537960899,0.999380275518845,0.999652969454261,0.99980569471523,0.999891214171656,0.999939096299146,0.999965903807018,0.999980911888092,0.999989313950406,0.999994017677906],[0.120271033732867,0.199761407300442,0.313091329218796,0.45422191282624,0.603113064028878,0.735076420319025,0.835155163398603,0.902445112986351,0.944105531606099,0.968594175751795,0.98255206753709,0.990368250879216,0.994701884178209,0.997091403117402,0.998404946180694,0.99912580393388,0.999521038431727,0.999737629609705,0.999856290188283,0.999921289131009,0.999956890774078,0.999976389849893,0.999987069258158,0.999992918161209,0.999996121467075],[0.110741677593021,0.188595394232302,0.302559712393951,0.447416749710442,0.601785680142982,0.738258304662068,0.84036686702197,0.907625837778361,0.94829001795063,0.971613217632423,0.984587726135756,0.991682847824979,0.995526533068224,0.997598201355881,0.99871171891676,0.999309346877935,0.999629840595461,0.999801640517398,0.999893712423368,0.999943050032577,0.999969486325609,0.99998365103721,0.999991240424758,0.999995306742753,0.999997485423506],[0.101879915578803,0.177914760871175,0.292231641259354,0.440631228752795,0.600456797811335,0.741415416430931,0.845444291521438,0.912558094529725,0.952177105009696,0.974349724625984,0.986389173467224,0.992819321874877,0.9962233131432,0.998016869948664,0.998959552300435,0.999454374874933,0.999713934048578,0.999850036928045,0.99992139062247,0.999958795026437,0.999978401818212,0.999988679106817,0.999994066074776,0.999996889699626,0.999998369720707],[0.0936526059341698,0.167713974363647,0.282113517396953,0.433867816516241,0.599126434938623,0.744547624076561,0.850388970598486,0.917251006974434,0.955785619893358,0.976828721504931,0.987982630522368,0.993801476243325,0.9968119114209,0.998362678268692,0.999159748789573,0.999568962051637,0.999778927230759,0.999886626759365,0.999941861599559,0.999970187121574,0.999984712419902,0.999992160822315,0.999995980234716,0.999997938752823,0.999998943038817],[0.0860260535372964,0.157985655087981,0.272210982721876,0.427128946875285,0.597794609514977,0.747654804763936,0.855202548875652,0.921713662700992,0.959133537516246,0.979073278937363,0.989391543478628,0.994650018002637,0.997309024190715,0.998648267931748,0.999321450878048,0.9996594928807,0.999829156713028,0.999914289719749,0.999957001878252,0.999978429668954,0.999989179196813,0.999994571749775,0.999997276928449,0.999998633978102,0.999999314739062]],"type":"surface","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>

]

---

# Three-dimensional models

.center[

<div id="htmlwidget-986e0f314e61cdefacb6" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-986e0f314e61cdefacb6">{"x":{"visdat":{"a0924888e6b0":["function () ","plotlyVisDat"]},"cur_data":"a0924888e6b0","attrs":{"a0924888e6b0":{"x":{},"y":{},"z":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Marginal effect on survival","scene":{"xaxis":{"title":"Age"},"yaxis":{"title":"Fare"},"zaxis":{"title":"AME"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"colorbar":{"title":"outcome","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(68,1,84,1)"],["0.18585914525608","rgba(66,64,131,1)"],["0.266979909107969","rgba(58,86,139,1)"],["0.377030367356628","rgba(46,114,142,1)"],["0.504631935802562","rgba(36,145,139,1)"],["0.535204221411934","rgba(34,153,138,1)"],["0.535401963603673","rgba(34,153,138,1)"],["0.535983504889339","rgba(34,153,138,1)"],["0.537109802701225","rgba(33,153,138,1)"],["0.539686629853747","rgba(33,154,138,1)"],["0.543575912592209","rgba(33,155,138,1)"],["0.550475911605026","rgba(32,157,137,1)"],["0.559721567735694","rgba(32,159,136,1)"],["0.574171404102056","rgba(36,162,134,1)"],["0.593082196398891","rgba(41,166,132,1)"],["0.609297727392402","rgba(44,170,130,1)"],["0.617878394382432","rgba(46,172,128,1)"],["0.640556244789652","rgba(49,177,125,1)"],["0.661607750630947","rgba(52,182,122,1)"],["0.683199233185421","rgba(65,186,117,1)"],["0.710462256644379","rgba(80,192,109,1)"],["0.746348679143544","rgba(96,199,99,1)"],["0.792792243664152","rgba(120,207,84,1)"],["0.862498661525598","rgba(165,218,58,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"x":[0.42,3.73583333333333,7.05166666666667,10.3675,13.6833333333333,16.9991666666667,20.315,23.6308333333333,26.9466666666667,30.2625,33.5783333333333,36.8941666666667,40.21,43.5258333333333,46.8416666666667,50.1575,53.4733333333333,56.7891666666667,60.105,63.4208333333333,66.7366666666667,70.0525,73.3683333333333,76.6841666666667,80],"y":[0,21.34705,42.6941,64.04115,85.3882,106.73525,128.0823,149.42935,170.7764,192.12345,213.4705,234.81755,256.1646,277.51165,298.8587,320.20575,341.5528,362.89985,384.2469,405.59395,426.941,448.28805,469.6351,490.98215,512.3292],"z":[[-0.00700931459297115,-0.00695404527601681,-0.00686959379486899,-0.00675738790125305,-0.0066192838842391,-0.00645750273543861,-0.00627455673923095,-0.00607317049721889,-0.00585620040815497,-0.00562655634727879,-0.00538712877590802,-0.00514072383683364,-0.00489000823209054,-0.00463746491136522,-0.00438535988459476,-0.00413571985707965,-0.0038903198978678,-0.00365068000323627,-0.00341806920306239,-0.00319351576493878,-0.00297782205827911,-0.00277158272471302,-0.00257520493810813,-0.00238892970626222,-0.0022128533482513],[-0.00537937638280977,-0.00538015547929276,-0.00536725152521584,-0.00534079548079265,-0.00530105437164991,-0.00524842559187834,-0.00518342853200155,-0.00510669383200867,-0.0050189506352052,-0.00492101227542812,-0.00481376086475936,-0.00469813126080273,-0.00457509488347278,-0.00444564382204526,-0.00431077562861433,-0.00417147913638841,-0.00402872157587407,-0.00388343719238376,-0.00373651749860883,-0.00358880322959246,-0.00344107800678192,-0.00329406366530957,-0.00314841715498357,-0.00300472889156005,-0.00286352241049648],[-0.00368884643751998,-0.00370508677850067,-0.00371688185964188,-0.0037241744578225,-0.00372692905676514,-0.00372513221392301,-0.00371879269968548,-0.00370794140643279,-0.00369263102930524,-0.00367293552416585,-0.00364894935229641,-0.00362078652499617,-0.00358857946456819,-0.00355247770098403,-0.00351264642582083,-0.00346926492703736,-0.00342252492926349,-0.00337262886502442,-0.00331978810237888,-0.00326422115411872,-0.00320615189254241,-0.00314580779264853,-0.00308341822471255,-0.00301921281509807,-0.00295341989192896],[-0.00200448369567751,-0.00201411473302748,-0.00202304918271406,-0.00203127407332531,-0.00203877738660338,-0.00204554809406307,-0.00205157619125953,-0.00205685272882069,-0.002061369840583,-0.00206512076831919,-0.00206809988320049,-0.00207030270362398,-0.00207172590958914,-0.0020723673532643,-0.00207222606590087,-0.0020713022609205,-0.00206959733322989,-0.0020671138547736,-0.00206385556626496,-0.00205982736525037,-0.00205503529048762,-0.00204948650277908,-0.00204318926232278,-0.00203615290272975,-0.00202838780184682],[-0.000389908041660816,-0.000390464549991854,-0.000391016241081406,-0.000391563084231047,-0.00039210504913139,-0.000392642105556754,-0.000393174223563961,-0.000393701373376921,-0.000394223525452141,-0.000394740650467747,-0.000395252719313654,-0.000395759703119861,-0.000396261573248918,-0.000396758301276214,-0.000397249859023232,-0.000397736218570694,-0.000398217352214132,-0.000398693232497629,-0.000399163832240749,-0.000399629124486456,-0.000400089082542675,-0.000400543679997904,-0.000400992890663646,-0.000401436688649276,-0.00040187504831826],[0.00109952088823531,0.00109346566648156,0.0010873144561438,0.00108106997961054,0.00107473497525448,0.00106831219520252,0.00106180440293991,0.00105521437110135,0.00104854487916117,0.00104179871128846,0.00103497865411859,0.00102808749460706,0.00102112801796735,0.00101410300554838,0.00100701523285184,0.000999867467524106,0.000992662467444938,0.000985402978844756,0.000978091734454353,0.000970731451723736,0.000963324831099122,0.000955874554347902,0.000948383282926357,0.000940853656407332,0.000933288290983404],[0.00242048595021802,0.00238259125306082,0.002343869265508,0.00230440264811036,0.00226427329859757,0.00222356205529011,0.00218234841982902,0.00214071030112673,0.00209872378053915,0.00205646289943711,0.00201399946863754,0.00197140290028059,0.00192874006173238,0.00188607515110707,0.00184346959393705,0.00180098196020852,0.00175866790108906,0.00171658010424539,0.00167476826687685,0.00163327908527184,0.00159215625984197,0.00155144051438936,0.00151116962846638,0.00147137848157218,0.00143209910805678],[0.00354376774825006,0.00344244429373485,0.00333941846565728,0.00323515359342642,0.00313009270100825,0.00302465586019531,0.00291923806674475,0.00281420762258688,0.00270990500020365,0.00260664215652966,0.00250470225923284,0.00240433978371911,0.0023057809373276,0.0022092243661119,0.00211484209993712,0.00202278069312765,0.00193316251983121,0.00184608718616604,0.00176163302449166,0.0016798586383084,0.00160080447037377,0.00152449436984444,0.00145093713799921,0.00138012803553588,0.00131205023747912],[0.00445453846009132,0.00425923423744271,0.00406304425138189,0.0038673122305129,0.00367325359984874,0.00348194993815299,0.00329434711800052,0.00311125663747998,0.00293335961894784,0.00276121294587686,0.00259525702803858,0.00243582472231332,0.00228315098589835,0.00213738289429826,0.00199858971596435,0.00186677279318043,0.00174187503413985,0.00162378987116409,0.00151236958455836,0.00140743292925006,0.00130877203329867,0.00121615856252289,0.00112934916575878,0.00104809022985475,0.000972121984443343],[0.00515116034810793,0.00483729664975939,0.00452739957510973,0.00422412052427325,0.00392967010102311,0.00364583077257419,0.00337398132935628,0.00311512976851432,0.00286995153469509,0.00263883047829765,0.0024219003755889,0.00221908534114574,0.00203013791957871,0.00185467404525941,0.00169220439656648,0.00154216194121755,0.00140392567542746,0.00127684070860713,0.00116023494523673,0.00105343267638594,0.000955765422786568,0.000866580378232736,0.000785246792110574,0.000711160609454674,0.000643747659446463],[0.00564294054563411,0.00519493366986014,0.00476175441772508,0.00434734063627574,0.00395458113363381,0.00358542023794208,0.00324098083878809,0.00292169441847106,0.00262742927837382,0.00235761077360276,0.00211132966144608,0.00188743653771722,0.00168462175546844,0.00150148122556531,0.00133656914961996,0.00118843910479258,0.00105567505870497,0.000936913903845693,0.000830861015667272,0.000736300197558496,0.000652099207739319,0.000577211888087205,0.000510677746226692,0.000451619687464701,0.000399240456019772],[0.00594734871811308,0.00535968475027688,0.00480472162672033,0.00428693471673505,0.00380886770867279,0.00337146868989342,0.00297442580937553,0.00261647920275846,0.00229569552959029,0.00200969906923879,0.00175585874704699,0.00153143395146374,0.00133368394749244,0.00115994650661592,0.00100769143004717,0.00087455424099182,0.000758354680647981,0.000657103914880991,0.000569003637143675,0.000492439593032622,0.000425971478260748,0.000368320681791317,0.000318356956399128,0.000275084790289346,0.000237630014251385],[0.00608715208641525,0.00536385909383675,0.00469798617192005,0.00409301358710824,0.00354950611344251,0.00306585889803232,0.00263896021383957,0.00226474427415047,0.00193862841323787,0.00165584215421912,0.00141166262431146,0.00120157329893925,0.00102136280366333,0.000867178739167711,0.000735549087736545,0.000623381251569214,0.000527946461596771,0.000446855317486264,0.000378028609771561,0.000319666315416964,0.00027021670240315,0.000228346774108856,0.000192914777599049,0.000162945145790605,0.000137606003317502],[0.00608780638078812,0.00524084831835451,0.00448167959539312,0.00381064227240821,0.00322436999554859,0.00271709781840302,0.0022817085622465,0.00191051580008405,0.00159581386574434,0.00133023785261597,0.00110697797026062,0.000919888055256139,0.000763521010870443,0.000633116579539624,0.000524560213174802,0.000434326325431772,0.000359414944786596,0.000297287612629658,0.000245806094142582,0.000203175891457932,0.0001678954919649,0.00013871160382824,0.000114580214314329,9.46330696764745e-05,7.81490579623381e-05],[0.00597530571726499,0.00502243439257045,0.00419148552445727,0.00347723003595402,0.00287045760111728,0.00235991036755271,0.00193366699634741,0.0015800573925594,0.00128821231654331,0.00104834864692106,0.000851875153654682,0.000691384288429154,0.000560577418448622,0.000454156034165584,0.000367700113925792,0.000297546657945323,0.000240675786411109,0.00019460809290083,0.000157314608186615,0.000127139332936068,0.000102733523242488,8.30005378781285e-05,6.70499261601841e-05,5.41594490244875e-05,4.37438173064781e-05],[0.0057745720014069,0.00473707939645778,0.00385722361125315,0.00312184025393009,0.00251430938535763,0.00201703120472634,0.00161298798032587,0.00128661792050397,0.00102421346831029,0.000814015547091693,0.000646129528461726,0.000512348719004758,0.000405940283746374,0.00032142649128543,0.000254379355398646,0.000201237299279852,0.000159146752080116,0.000125828344001386,9.94656943087745e-05,7.86140700587226e-05,6.2126029481818e-05,4.90912986277745e-05,3.87884069473797e-05,3.06459364664599e-05,2.42115691995299e-05],[0.00550837269071442,0.0044090482189155,0.00350252159387217,0.00276570434637729,0.00217354315900526,0.00170180399447591,0.00132856001366521,0.00103481206556579,0.000804580582998963,0.000624708079089226,0.00048452748621077,0.000375489713861923,0.000290801991959776,0.000225102141117654,0.000174178213374531,0.000134734249272018,0.00010419853113764,8.05688930828581e-05,6.22892422566523e-05,4.81517633323305e-05,3.72199165856836e-05,2.87680754043758e-05,2.22343656934656e-05,1.71839136335678e-05,1.32802603704534e-05],[0.00519669882607844,0.00405816028096062,0.00314518439315845,0.00242335026145702,0.00185875984165267,0.0014207717877163,0.0010831134853277,0.000824035077630758,0.000625964126699563,0.000474947621144248,0.000360045110893061,0.000272757180191993,0.000206525795590473,0.000156316546499599,0.000118279327174676,8.94781152023772e-05,6.7678737959016e-05,5.11838317112239e-05,3.87054243121835e-05,2.92670860508756e-05,2.21290822800623e-05,1.67312881385101e-05,1.26497454508859e-05,9.56365579819884e-06,7.23033356792251e-06],[0.0048565087446233,0.00369996660334153,0.00279793852315149,0.00210393543136772,0.00157538468726042,0.00117587915224259,0.000875608360177823,0.000650864912321371,0.000483172469648952,0.000358336124951956,0.000265561640271016,0.000196701479868006,0.000145639010640756,0.000107800386414161,7.97753178520659e-05,5.90264861438094e-05,4.3669039838415e-05,3.23044332474401e-05,2.38958414830517e-05,1.76750891156405e-05,1.30733058816216e-05,9.6693613196474e-06,7.15157489589204e-06,5.28931380460417e-06,3.91194145712505e-06],[0.00450173865626818,0.00334617891719147,0.00246932061981548,0.00181253804148652,0.00132523901180928,0.000966175751442768,0.000702926774385051,0.000510626517905025,0.000370524271523304,0.000268646783836512,0.00019466777843698,0.000141001419353138,0.000102098727958947,7.39130607383956e-05,5.34998482190641e-05,3.87198452474728e-05,2.80206542769919e-05,2.02766678092534e-05,1.46722202357272e-05,1.06164982956533e-05,7.68168989524101e-06,5.55808298203495e-06,4.02149985301114e-06,2.90969393440983e-06,2.10525072472503e-06],[0.00414349071503854,0.00300521897694283,0.00216456271457635,0.00155128308508923,0.0011077810713044,0.000789048975423724,0.000560997810465802,0.000398340646260992,0.000282584118209295,0.000200335014460289,0.000141959550399776,0.000100561022322994,7.12186381449543e-05,5.04296626702863e-05,3.57048958972486e-05,2.5277469198768e-05,1.78942706171556e-05,1.26670774526537e-05,8.96656538354638e-06,6.34697520179466e-06,4.49263467856792e-06,3.18002763635698e-06,2.25090666954749e-06,1.59324227247994e-06,1.12772849752645e-06],[0.00379032528612207,0.00268279697588151,0.0018863924379408,0.00132025957000779,0.000921031466106549,0.000641068216309672,0.000445500359187845,0.000309253849578542,0.0002145118022333,0.000148715992894341,0.000103063522213642,7.14071943472244e-05,4.94655139212668e-05,3.42617967324048e-05,2.37290892455367e-05,1.64333689783723e-05,1.13803221048315e-05,7.88080028691895e-06,5.45729782380008e-06,3.77901964111694e-06,2.61683656140961e-06,1.81205448059688e-06,1.25476952814031e-06,8.68871067343348e-07,6.0165257378869e-07],[0.00344860184270774,0.00238246214250852,0.00163571194218224,0.00111823105318012,0.000762231607225384,0.000518533642978101,0.000352271980313847,0.000239099790358592,0.000162184269983272,0.000109964892670604,7.45374405782493e-05,5.05138224628905e-05,3.42285588472034e-05,2.31914613753017e-05,1.57123547581751e-05,1.06447775565193e-05,7.21140380846566e-06,4.88534062789821e-06,3.30951487965041e-06,2.24197140286235e-06,1.51877435099025e-06,1.02885629201683e-06,6.96971491214358e-07,4.72144050661495e-07,3.19840527591651e-07],[0.00312282936805545,0.00210609442256281,0.00141214794734607,0.000943164037070844,0.000628292105182663,0.000417812357817345,0.000277523024567144,0.000184197327387931,0.000122192994765816,8.10331027044509e-05,5.37255978999369e-05,3.56152083388541e-05,2.36073329653958e-05,1.56469608410717e-05,1.03703703310123e-05,6.87299575482236e-06,4.55501308529593e-06,3.01875391724341e-06,2.00060876717934e-06,1.3258494827862e-06,8.78667754426627e-07,5.82309798517473e-07,3.85907139819776e-07,2.55747304027138e-07,1.69488022272726e-07],[0.00281600085910736,0.00185432407574692,0.00121448131870096,0.000792606702215938,0.000516083998343828,0.000335528200211374,0.000217927682263122,0.000141455402979863,9.17798557671376e-05,5.95331493315731e-05,3.86095621588182e-05,2.50369805805286e-05,1.62344391877451e-05,1.05262105040093e-05,6.82485562772998e-06,4.42492829368028e-06,2.86888671250879e-06,1.86001705599214e-06,1.20591888950513e-06,7.81839746095792e-07,5.06893124379943e-07,3.28635457798428e-07,2.13064953670005e-07,1.38136790254091e-07,8.95584412088022e-08]],"type":"surface","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>

]

---

# Interpreting models

* Model-specific methods
* Model-agnostic methods

--

## Desirable traits

* Model flexibility
* Explanation flexibility
* Representation flexibility

--

## Type of interpretation

* Global
* Local

---

# `attrition`












```
## Observations: 1,470
## Variables: 31
## $ Age                      &lt;int&gt; 41, 49, 37, 33, 27, 32, 59, 30, 38, 36,…
## $ Attrition                &lt;fct&gt; 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ BusinessTravel           &lt;fct&gt; Travel_Rarely, Travel_Frequently, Trave…
## $ DailyRate                &lt;int&gt; 1102, 279, 1373, 1392, 591, 1005, 1324,…
## $ Department               &lt;fct&gt; Sales, Research_Development, Research_D…
## $ DistanceFromHome         &lt;int&gt; 1, 8, 2, 3, 2, 2, 3, 24, 23, 27, 16, 15…
## $ Education                &lt;fct&gt; College, Below_College, College, Master…
## $ EducationField           &lt;fct&gt; Life_Sciences, Life_Sciences, Other, Li…
## $ EnvironmentSatisfaction  &lt;fct&gt; Medium, High, Very_High, Very_High, Low…
## $ Gender                   &lt;fct&gt; Female, Male, Male, Female, Male, Male,…
## $ HourlyRate               &lt;int&gt; 94, 61, 92, 56, 40, 79, 81, 67, 44, 94,…
## $ JobInvolvement           &lt;fct&gt; High, Medium, Medium, High, High, High,…
## $ JobLevel                 &lt;int&gt; 2, 2, 1, 1, 1, 1, 1, 1, 3, 2, 1, 2, 1, …
## $ JobRole                  &lt;fct&gt; Sales_Executive, Research_Scientist, La…
## $ JobSatisfaction          &lt;fct&gt; Very_High, Medium, High, High, Medium, …
## $ MaritalStatus            &lt;fct&gt; Single, Married, Single, Married, Marri…
## $ MonthlyIncome            &lt;int&gt; 5993, 5130, 2090, 2909, 3468, 3068, 267…
## $ MonthlyRate              &lt;int&gt; 19479, 24907, 2396, 23159, 16632, 11864…
## $ NumCompaniesWorked       &lt;int&gt; 8, 1, 6, 1, 9, 0, 4, 1, 0, 6, 0, 0, 1, …
## $ OverTime                 &lt;fct&gt; Yes, No, Yes, Yes, No, No, Yes, No, No,…
## $ PercentSalaryHike        &lt;int&gt; 11, 23, 15, 11, 12, 13, 20, 22, 21, 13,…
## $ PerformanceRating        &lt;fct&gt; Excellent, Outstanding, Excellent, Exce…
## $ RelationshipSatisfaction &lt;fct&gt; Low, Very_High, Medium, High, Very_High…
## $ StockOptionLevel         &lt;int&gt; 0, 1, 0, 0, 1, 0, 3, 1, 0, 2, 1, 0, 1, …
## $ TotalWorkingYears        &lt;int&gt; 8, 10, 7, 8, 6, 8, 12, 1, 10, 17, 6, 10…
## $ TrainingTimesLastYear    &lt;int&gt; 0, 3, 3, 3, 3, 2, 3, 2, 2, 3, 5, 3, 1, …
## $ WorkLifeBalance          &lt;fct&gt; Bad, Better, Better, Better, Better, Go…
## $ YearsAtCompany           &lt;int&gt; 6, 10, 0, 8, 2, 7, 1, 1, 9, 7, 5, 9, 5,…
## $ YearsInCurrentRole       &lt;int&gt; 4, 7, 0, 7, 2, 7, 0, 0, 7, 7, 4, 5, 2, …
## $ YearsSinceLastPromotion  &lt;int&gt; 0, 1, 0, 3, 2, 3, 0, 0, 1, 7, 0, 0, 4, …
## $ YearsWithCurrManager     &lt;int&gt; 5, 7, 0, 0, 2, 6, 0, 0, 8, 7, 3, 8, 3, …
```

---

# `attrition`

## Model types

* Logistic regression (`glm`)
* Naive Bayes (`nb`)
* Gradient boosting machine (`gbm`)

---

# Partial dependence plot

`$$\hat{f}_{x_S}(x_S)=\E_{x_C}\left[\hat{f}(x_S,x_C)\right]=\int\hat{f}(x_S,x_C)d\Pr(x_C)$$`

* Marginal effect a feature has on the predictor
* `\(x_s\)` - features we want to know
* `\(x_C\)` - all the other features
* Average over all remaining features
* Equivalent to AME in regression models

---

# Individual conditional expectation

* Plot one line per observation that shows how the observation's prediction changes when a feature changes
* PDP is average of all ICEs
* Captures heterogeneous relationships created by interactions
* Shows the full distribution rather than a single summary line
* Centered ICE plot

---

# PDP/ICE

```
For a selected predictor (x)
1. Determine grid space of j evenly spaced values across distribution of x
2: for value i in {1,...,j} of grid space do
     | set x to i for all observations
     | apply given ML model
     | estimate predicted value
     | if PDP: average predicted values across all observations
   end
```

---

# Categorical variables

&lt;img src="interpret-ml_files/figure-html/pdp-1.png" width="864" /&gt;

---

# Continuous variables

&lt;img src="interpret-ml_files/figure-html/pdp-cont-1.png" width="864" /&gt;

---

# Two-way interactions

&lt;img src="interpret-ml_files/figure-html/pdp-two-way-1.png" width="864" /&gt;

---

# PDP/ICE

## Strengths

* Intuitive
* Interpretation is clear (if other features are uncorrelated)
* Easy to implement
* Uncover heterogeneous relationships (ICE only)

## Weaknesses

* Maximum number of features
* No feature distribution (resolved with ICE)
* Assumption of independence

---

# Measuring interactions

* Measuring interactions without explicit interaction terms
* H-statistic

    ```
    1: for variable i in {1,...,p} do
         | f(x) = estimate predicted values with original model
         | pd(x) = partial dependence of variable i
         | pd(!x) = partial dependence of all features excluding i
         | upper = sum(f(x) - pd(x) - pd(!x))
         | lower = variance(f(x))
         | rho = upper / lower
       end
    2. Sort variables by descending rho (interaction strength)  
    ```

--

* Share of variance explained by the interaction
* `\(\rho \in [0,1]\)`
    * `\(0\)` - no interaction
    * `\(1\)` - all variation depends on a given interaction

---

# Measuring interactions

&lt;img src="interpret-ml_files/figure-html/interactions-1.png" width="864" /&gt;

---

# Measuring interactions

* With which other variable(s) is the interaction strongest?

```
1: i = a selected variable of interest
2: for remaining variables j in {1,...,p} do
     | pd(ij) = interaction partial dependence of variables i and j
     | pd(i) = partial dependence of variable i
     | pd(j) = partial dependence of variable j
     | upper = sum(pd(ij) - pd(i) - pd(j))
     | lower = variance(pd(ij))
     | rho = upper / lower
   end
3. Sort interaction relationship by descending rho (interaction strength)  
```

---

# Measuring interactions

&lt;img src="interpret-ml_files/figure-html/interactions-overtime-1.png" width="864" /&gt;

---

# Measuring interactions

## Strengths

* Underlying theory via partial dependence decomposition
* Dimensionless
* Detects all shapes of interactions

## Weaknesses

* Computationally intensive
* Requires sampling from the distribution rather than using the entire distribution
* No test for statistical significance

---

# Feature importance

* Calculate the increase in the model's prediction error after **permuting** the feature
    * Randomly shuffle the feature's values across observations
* Important feature
* Unimportant feature

```
For any given loss function do
1: compute loss function for original model
2: for variable i in {1,...,p} do
     | randomize values
     | apply given ML model
     | estimate loss function
     | compute feature importance (permuted loss / original loss)
   end
3. Sort variables by descending feature importance   
```

---

# Feature importance

&lt;img src="interpret-ml_files/figure-html/feature-imp-1.png" width="864" /&gt;

---

# Feature importance

## Strengths

* Nice interpretation
* Global insight into each variable's performance
* Takes into account all interactions
* Does not require retraining the model

## Weaknesses

* Depends on random shuffling - results can vary
* Computationally intensive
* Correlated features
    * Unrealistic observations
    * Adding correlated feature can decrease importance of the original feature

---

# Global surrogate

* Interpretable model trained to approximate the predictions of a black box model
* Generate conclusions about the black box model by interpreting the simpler model

`$$g(f(x)) = \beta_0 + \beta_1 x_1 + \ldots + \beta_p x_p$$`

---

# Global surrogate

1. Apply original model and get predictions
1. Choose an interpretable "white box" model (linear model, decision tree)
1. Train the interpretable model on the original dataset and its predictions
1. Measure how well the surrogate model replicates the prediction of the black box model
1. Interpret / visualize the surrogate model

--
* How well does the surrogate model replicate the black box model?

---

# Global surrogate

.pull-left[

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; model &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; r.squared &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GLM &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5547788 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; NB &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.7097939 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GBM &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.4384319 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

]

.pull-right[

&lt;img src="interpret-ml_files/figure-html/global-surrogate-nb-1.png" width="504" /&gt;

]

---

# Global surrogate

## Strengths

* Flexible (uses any interpretable model)
* Intuitive
* Easy measure of how well the surrogate model approximates the black box model

## Weaknesses

* Draw conclusions about the model, not the data
* What makes a good surrogate model?
* Surrogate model systematically over/underpredicts subsets of the data set
* Accept the flaws of the interpretable model

---

# LIME

## Local Interpretable Model-agnostic Explanations

* Global `\(\rightarrow\)` local
* Interpretable models used to explain individual predictions of a black box model
* Assumes every complex model is linear on a local scale
* Fit a simple model around a single observation to mimic how the global model behaves at that locality
* Simple model explains the predictions of the complex model **locally**
    * Local fidelity
    * Does not require global fidelity

---

# LIME

`$$\text{explanation}(x) = \arg \min_{g \in G} L(f, g, \pi_x) + \Omega(g)$$`

* Explanation model for `\(x\)`
* Minimize loss `\(L\)`
    * Difference between explanation and original prediction `\(g(x)\)`
* `\(G\)` - family of possible explanations
* `\(\pi_x\)`
* Keep `\(\Omega(g)\)` low to be interpretable by humans

---

# LIME

1. For each prediction to explain, permute the observation `\(n\)` times
1. Let the complex model predict the outcome of all permuted observations
1. Calculate the distance from all permutations to the original observation
1. Convert the distance to a similarity score
1. Select `\(m\)` features best describing the complex model outcome from the permuted data
1. Fit a simple model to the permuted data, explaining the complex model outcome with the `\(m\)` features from the permuted data weighted by its similarity to the original observation
1. Extract the feature weights from the simple model and use these as explanations for the complex models local behavior







---

# Features plot



&lt;img src="interpret-ml_files/figure-html/lime-nb-1.png" width="864" /&gt;

---

# Explanations plot

&lt;img src="interpret-ml_files/figure-html/lime-glm-1.png" width="864" /&gt;

---

# Comparing models

&lt;img src="interpret-ml_files/figure-html/lime-interpret-all-1.png" width="864" /&gt;

---

# Tuning LIME

* Interpretable model
* Distance metric
* Size of local region
* Feature selection

---

# Tuning LIME

.pull-left[

* Gower's distance

    `$$d(\mathbf{p}, \mathbf{q}) = \frac{1}{k} \sum_{i=1}^k d_{p_i q_i}^{(f)}$$`
    
    * Range for each variable `\([0,1]\)`

* `\(\text{Kernel width} = 0.75\)`
* `\(\text{Number of features} = 5\)`
* Feature selection - ridge regression

]

.pull-right[

* Manhattan distance

    `$$d(\mathbf{p}, \mathbf{q}) = \sum_{i = 1}^k | p_i - q_i|$$`

* `\(\text{Kernel width} = 3\)`
* `\(\text{Number of features} = 10\)`
* Feature selection - lasso regression

]

---

# Tuning LIME

&lt;img src="interpret-ml_files/figure-html/explain-tuning-1.png" width="864" /&gt;

---

# LIME for images

&lt;img src="interpret-ml_files/figure-html/lime-images-package-example-1.png" width="504" /&gt;

---

# LIME

## Strengths

* Same explanatory model for different machine learning algorithms
* Human-friendly explanations
* Works for tabular, text, and image data

## Weaknesses

* What is the correct neighborhood?
* Complexity of explanation model is defined a priori
* Explanations for similar data points can vary greatly
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://cfss.uchicago.edu/slides/macros.js"></script>
<script>var slideshow = remark.create({
"highlightLanguage": "r",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
