---
title: Regression splines
date: 2019-02-18T13:30:00-06:00  # Schedule page publish date.
    
draft: false
type: docs

bibliography: [../../static/bib/sources.bib]
csl: [../../static/bib/apa.csl]
link-citations: true

menu:
  notes:
    parent: Moving beyond linearity
    weight: 2
---

<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<div id="TOC">
<ul>
<li><a href="#basis-functions"><span class="toc-section-number">1</span> Basis functions</a></li>
<li><a href="#regression-splines"><span class="toc-section-number">2</span> Regression splines</a><ul>
<li><a href="#piecewise-polynomials"><span class="toc-section-number">2.1</span> Piecewise polynomials</a></li>
<li><a href="#constraints-and-splines"><span class="toc-section-number">2.2</span> Constraints and splines</a></li>
<li><a href="#spline-basis-representation"><span class="toc-section-number">2.3</span> Spline basis representation</a></li>
<li><a href="#basis-splines-vs.natural-splines"><span class="toc-section-number">2.4</span> Basis splines vs. natural splines</a></li>
<li><a href="#choosing-the-number-and-location-of-knots"><span class="toc-section-number">2.5</span> Choosing the number and location of knots</a></li>
<li><a href="#comparison-to-polynomial-regression"><span class="toc-section-number">2.6</span> Comparison to polynomial regression</a></li>
</ul></li>
<li><a href="#smoothing-splines"><span class="toc-section-number">3</span> Smoothing splines</a><ul>
<li><a href="#choosing-the-smoothing-parameter-lambda"><span class="toc-section-number">3.1</span> Choosing the smoothing parameter <span class="math inline">\(\lambda\)</span></a></li>
</ul></li>
<li><a href="#session-info"><span class="toc-section-number">4</span> Session Info</a></li>
<li><a href="#references"><span class="toc-section-number">5</span> References</a></li>
</ul>
</div>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(tidymodels)
<span class="kw">library</span>(rcfss)
<span class="kw">library</span>(titanic)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(splines)
<span class="kw">library</span>(ISLR)
<span class="kw">library</span>(lattice)
<span class="kw">library</span>(gam)
<span class="kw">library</span>(here)
<span class="kw">library</span>(patchwork)
<span class="kw">library</span>(margins)
<span class="kw">library</span>(earth)

<span class="kw">set.seed</span>(<span class="dv">1234</span>)
<span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</code></pre></div>
<div id="basis-functions" class="section level1">
<h1><span class="header-section-number">1</span> Basis functions</h1>
<p><strong>Basis functions</strong> are a family of functions or transformations applied to a variable <span class="math inline">\(X\)</span>: <span class="math inline">\(b_1(X), b_2(X), \ldots, b_K(X)\)</span>. Instead of fitting the linear model to <span class="math inline">\(X\)</span>, we fit the model:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1 b_1(x_i) + \beta_2 b_2(x_i) + \beta_3 b_3(x_i) + \ldots + \beta_K b_K(x_i) + \epsilon_i\]</span></p>
<p>The functional form of the basis function is determined in advanced and is fixed and known. <a href="/notes/global-methods/">Polynomial and step functions</a> are specific types of basis functions. For polynomial regression, <span class="math inline">\(b_j(x_i) = x_i^j\)</span> where <span class="math inline">\(j\)</span> is the polynomial degree. Since this linear model is just a transformation of the predictors <span class="math inline">\(X_i\)</span>, we can use least squares to estimate the model and apply all the standard statistical inferential techniques to evaluate and interpret the model.</p>
</div>
<div id="regression-splines" class="section level1">
<h1><span class="header-section-number">2</span> Regression splines</h1>
<p><strong>Regression splines</strong> extend polynomial transformations and piecewise constant regression by fitting separate polynomial functions over different regions of <span class="math inline">\(X\)</span>.</p>
<div id="piecewise-polynomials" class="section level2">
<h2><span class="header-section-number">2.1</span> Piecewise polynomials</h2>
<p><strong>Piecewise polynomial regression</strong> fits separate low-degree polynomials for different regions of <span class="math inline">\(X\)</span>. For instance, a cubic piecewise polynomial regression model takes the form:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \beta_3 x_i^3 + \epsilon_i\]</span></p>
<p>where the <span class="math inline">\(\beta\)</span>s are now vectors with different values for different parts of the range of <span class="math inline">\(X\)</span>. The points where the parameters change are called <strong>knots</strong>.</p>
<p>The special case of a piecewise cubic polynomial with 0 knots is just an ordinary cubic polynomial:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \beta_3 x_i^3 + \epsilon_i\]</span></p>
<p>Likewise, the special case of a piecewise constant polynomial (i.e. polynomial with degree <span class="math inline">\(0\)</span>) is piecewise constant regression.</p>
<p>A piecewise cubic polynomial with a single knot at point <span class="math inline">\(c\)</span> takes the form:</p>
<p><span class="math display">\[y_i = \begin{cases} 
      \beta_{01} + \beta_{11}x_i^2 + \beta_{21}x_i^2 + \beta_{31}x_i^3 + \epsilon_i &amp; \text{if } x_i &lt; c \\
      \beta_{02} + \beta_{12}x_i^2 + \beta_{22}x_i^2 + \beta_{32}x_i^3 + \epsilon_i &amp; \text{if } x_i \geq c
   \end{cases}\]</span></p>
<p>In essence, we fit two separate polynomial functions to the data. Each function is estimated using least squares applied to the individual functions and subsets of data. The more knots <span class="math inline">\(K\)</span> used, the more flexible the piecewise polynomial.</p>
<p>While the example here uses a cubic (third-order) polynomial, we don’t have to use it. We could select any higher-order degree for the polynomial.</p>
<p>Of course this leads to a somewhat odd and discontinuous function:</p>
<p><img src="/notes/splines_files/figure-html/sim-piecewise-1.png" width="672" /></p>
</div>
<div id="constraints-and-splines" class="section level2">
<h2><span class="header-section-number">2.2</span> Constraints and splines</h2>
<p>Instead of a discontinuous piecewise function, we’d rather have something continuous. That is, we impose the <strong>constraint</strong> that the fitted curve must be continuous.</p>
<p><img src="/notes/splines_files/figure-html/sim-spline-1.png" width="672" /></p>
<p>But notice that this constraint is insufficient. Now the function is continuous, but still looks unnatural because of the V-shaped join. We should add two additional constraints: not only should the fitted curve be continuous, but the first and second <strong>derivatives</strong> should also be continuous at the knot. This will generate a fitted curve that is continuous and <strong>smooth</strong>.</p>
<p><img src="/notes/splines_files/figure-html/sim-spline-smooth-1.png" width="672" /></p>
<p>By increasing the number of knots, we will increase the flexibility of the resulting spline:</p>
<p><img src="/notes/splines_files/figure-html/sim-spline-smooth-5-1.png" width="672" /></p>
</div>
<div id="spline-basis-representation" class="section level2">
<h2><span class="header-section-number">2.3</span> Spline basis representation</h2>
<p>Regression splines can be represented as basis functions, which identifies how they can be estimated using OLS and still fit it under the constraint that it and its derivatives can be continuous. A cubic spline with <span class="math inline">\(K\)</span> knots can be modeled as</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1 b_1 (x_i) + \beta_2 b_2 (x_i) + \cdots + \beta_{K + 3} b_{K + 3} (x_i) + \epsilon_i\]</span></p>
<p>for an appropriate choice of basis functions <span class="math inline">\(b_1, b_2, \ldots, b_{K+3}\)</span><span class="math inline">\(.^[\)</span>K$ knots with a polynomial degree of <span class="math inline">\(3\)</span>.]</p>
<p>The basis function for a cubic spline is to start with a basis for a cubic polynomial and then add one <strong>truncated power basis</strong> function per knot. A truncated power basis function is defined as:</p>
<p><span class="math display">\[
h(x, \zeta) = (x - \zeta)_+^3 = 
\begin{cases} 
  (x - \zeta)^3 &amp; \text{if } x &gt; \zeta \\
  0 &amp; \text{otherwise}
\end{cases}
\]</span></p>
<p>where <span class="math inline">\(\zeta\)</span> is the knot. Adding a term of the form <span class="math inline">\(\beta_4 h(x, \zeta)\)</span> to this model will lead to a discontinuity in only the third derivative at <span class="math inline">\(\zeta\)</span>. The function remains continuous, with continuous first and second derivatives, at each of the knots.</p>
<p>So fitting a cubic spline to a data set with <span class="math inline">\(K\)</span> knots requires least squares with an intercept and <span class="math inline">\(3 + K\)</span> predictors</p>
<p><span class="math display">\[X, X^2, X^3, h(X, \zeta_1), h(X, \zeta_2), \ldots, h(X, \zeta_K)\]</span></p>
<p>where <span class="math inline">\(\zeta_1, \ldots, \zeta_K\)</span> are the knots. This amounts to estimating a total of <span class="math inline">\(K + 4\)</span> regression coefficients, and so fitting a cubic spline with <span class="math inline">\(K\)</span> knots uses <span class="math inline">\(K+4\)</span> degrees of freedom.</p>
<p>Notice how the model matrix is constructed when constructing a cubic spline with <span class="math inline">\(K = 4\)</span> knots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_piece <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(x) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_cols</span>(<span class="dt">splines =</span> <span class="kw">bs</span>(sim_piece<span class="op">$</span>x, <span class="dt">df =</span> <span class="dv">7</span>) <span class="op">%&gt;%</span>
<span class="st">              </span>as_tibble)</code></pre></div>
<pre><code>## # A tibble: 100 x 8
##         x    `1`   `2`     `3`    `4`   `5`        `6`   `7`
##     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;
##  1 1.14   0.499  0.416 0.0489  0      0     0          0    
##  2 6.22   0      0     0.0203  0.505  0.446 0.0288     0    
##  3 6.09   0      0     0.0293  0.539  0.412 0.0199     0    
##  4 6.23   0      0     0.0196  0.502  0.449 0.0297     0    
##  5 8.61   0      0     0       0.0253 0.271 0.568      0.136
##  6 6.40   0      0     0.0112  0.454  0.490 0.0450     0    
##  7 0.0950 0      0     0       0      0     0          0    
##  8 2.33   0.0326 0.528 0.428   0.0113 0     0          0    
##  9 6.66   0      0     0.00360 0.377  0.542 0.0773     0    
## 10 5.14   0      0     0.183   0.663  0.155 0.00000183 0    
## # … with 90 more rows</code></pre>
</div>
<div id="basis-splines-vs.natural-splines" class="section level2">
<h2><span class="header-section-number">2.4</span> Basis splines vs. natural splines</h2>
<p>One drawback to the splines as currently presented (known as <strong>basis splines</strong>) is that they have high variance at the outer range of the predictors. Consider a basis spline with 3 knots applied to the <a href="/notes/global-methods/#age-and-voting">voting and age logistic regression model</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mh &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">here</span>(<span class="st">&quot;static&quot;</span>, <span class="st">&quot;data&quot;</span>, <span class="st">&quot;mental_health.csv&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>na.omit</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   vote96 = col_double(),
##   mhealth_sum = col_double(),
##   age = col_double(),
##   educ = col_double(),
##   black = col_double(),
##   female = col_double(),
##   married = col_double(),
##   inc10 = col_double()
## )</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate model</span>
<span class="kw">glm</span>(vote96 <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(age, <span class="dt">df =</span> <span class="dv">6</span>), <span class="dt">data =</span> mh, <span class="dt">family =</span> binomial) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cplot</span>(<span class="st">&quot;age&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;prediction&quot;</span>, <span class="dt">n =</span> <span class="dv">101</span>, <span class="dt">draw =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> xvals)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> yvals)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> upper), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> lower), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rug</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mh, vote96 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>), <span class="kw">aes</span>(age), <span class="dt">alpha =</span> .<span class="dv">02</span>, <span class="dt">sides =</span> <span class="st">&quot;b&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rug</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mh, vote96 <span class="op">==</span><span class="st"> </span><span class="dv">1</span>), <span class="kw">aes</span>(age), <span class="dt">alpha =</span> .<span class="dv">02</span>, <span class="dt">sides =</span> <span class="st">&quot;t&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Predicted probability of voting&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Basis spline with 3 knots&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted probability of voting&quot;</span>)</code></pre></div>
<pre><code>##    xvals     yvals     upper     lower
## 1  20.00 0.4282572 0.6315037 0.2250108
## 2  20.69 0.4252639 0.5830173 0.2675105
## 3  21.38 0.4246071 0.5481272 0.3010870
## 4  22.07 0.4260944 0.5265015 0.3256873
## 5  22.76 0.4295415 0.5170318 0.3420513
## 6  23.45 0.4347695 0.5170475 0.3524915
## 7  24.14 0.4416011 0.5228858 0.3603164
## 8  24.83 0.4498581 0.5313812 0.3683349
## 9  25.52 0.4593585 0.5405596 0.3781574
## 10 26.21 0.4699149 0.5494659 0.3903640
## 11 26.90 0.4813335 0.5578165 0.4048505
## 12 27.59 0.4934140 0.5657556 0.4210723
## 13 28.28 0.5059509 0.5737105 0.4381912
## 14 28.97 0.5187348 0.5822745 0.4551952
## 15 29.66 0.5315551 0.5920402 0.4710700
## 16 30.35 0.5442022 0.6033437 0.4850607
## 17 31.04 0.5564701 0.6160135 0.4969267
## 18 31.73 0.5681589 0.6293302 0.5069876
## 19 32.42 0.5790760 0.6422407 0.5159114
## 20 33.11 0.5890377 0.6536391 0.5244362</code></pre>
<p><img src="/notes/splines_files/figure-html/vote-age-basis-spline-1.png" width="672" /></p>
<p>Notice the 95% confidence interval balloons at both low and high values for age. To control for this, we impose <strong>boundary constraints</strong>: the function is required to be linear at the boundary (the region where <span class="math inline">\(X\)</span> is smaller than the smallest knot, or larger than the largest knot). This type of spline is known as a <strong>natural spline</strong>. This leads to more stable estimates at the boundaries.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate basis spline model</span>
vote_age_basis &lt;-<span class="st"> </span><span class="kw">glm</span>(vote96 <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(age, <span class="dt">df =</span> <span class="dv">6</span>), <span class="dt">data =</span> mh, <span class="dt">family =</span> binomial) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cplot</span>(<span class="st">&quot;age&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;prediction&quot;</span>, <span class="dt">n =</span> <span class="dv">101</span>, <span class="dt">draw =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##    xvals     yvals     upper     lower
## 1  20.00 0.4282572 0.6315037 0.2250108
## 2  20.69 0.4252639 0.5830173 0.2675105
## 3  21.38 0.4246071 0.5481272 0.3010870
## 4  22.07 0.4260944 0.5265015 0.3256873
## 5  22.76 0.4295415 0.5170318 0.3420513
## 6  23.45 0.4347695 0.5170475 0.3524915
## 7  24.14 0.4416011 0.5228858 0.3603164
## 8  24.83 0.4498581 0.5313812 0.3683349
## 9  25.52 0.4593585 0.5405596 0.3781574
## 10 26.21 0.4699149 0.5494659 0.3903640
## 11 26.90 0.4813335 0.5578165 0.4048505
## 12 27.59 0.4934140 0.5657556 0.4210723
## 13 28.28 0.5059509 0.5737105 0.4381912
## 14 28.97 0.5187348 0.5822745 0.4551952
## 15 29.66 0.5315551 0.5920402 0.4710700
## 16 30.35 0.5442022 0.6033437 0.4850607
## 17 31.04 0.5564701 0.6160135 0.4969267
## 18 31.73 0.5681589 0.6293302 0.5069876
## 19 32.42 0.5790760 0.6422407 0.5159114
## 20 33.11 0.5890377 0.6536391 0.5244362</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vote_age_natural &lt;-<span class="st"> </span><span class="kw">glm</span>(vote96 <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">6</span>), <span class="dt">data =</span> mh, <span class="dt">family =</span> binomial) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cplot</span>(<span class="st">&quot;age&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;prediction&quot;</span>, <span class="dt">n =</span> <span class="dv">101</span>, <span class="dt">draw =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##    xvals     yvals     upper     lower
## 1  20.00 0.4104826 0.5694648 0.2515004
## 2  20.69 0.4164015 0.5559878 0.2768153
## 3  21.38 0.4224142 0.5436063 0.3012221
## 4  22.07 0.4285896 0.5330443 0.3241349
## 5  22.76 0.4349974 0.5251454 0.3448493
## 6  23.45 0.4417080 0.5208182 0.3625978
## 7  24.14 0.4487925 0.5208045 0.3767806
## 8  24.83 0.4563220 0.5252608 0.3873833
## 9  25.52 0.4643677 0.5334863 0.3952491
## 10 26.21 0.4730003 0.5441737 0.4018268
## 11 26.90 0.4822894 0.5559448 0.4086340
## 12 27.59 0.4923030 0.5676942 0.4169119
## 13 28.28 0.5031066 0.5786781 0.4275350
## 14 28.97 0.5147614 0.5885220 0.4410008
## 15 29.66 0.5272658 0.5973413 0.4571904
## 16 30.35 0.5403484 0.6059590 0.4747378
## 17 31.04 0.5536612 0.6154724 0.4918501
## 18 31.73 0.5668598 0.6267950 0.5069247
## 19 32.42 0.5796078 0.6401201 0.5190955
## 20 33.11 0.5915809 0.6546306 0.5285313</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bind_rows</span>(
  <span class="dt">Basis =</span> vote_age_basis,
  <span class="dt">Natural =</span> vote_age_natural,
  <span class="dt">.id =</span> <span class="st">&quot;model&quot;</span>
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> xvals)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> yvals, <span class="dt">color =</span> model)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> upper, <span class="dt">color =</span> model), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> lower, <span class="dt">color =</span> model), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rug</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mh, vote96 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>), <span class="kw">aes</span>(age), <span class="dt">alpha =</span> .<span class="dv">02</span>, <span class="dt">sides =</span> <span class="st">&quot;b&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rug</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mh, vote96 <span class="op">==</span><span class="st"> </span><span class="dv">1</span>), <span class="kw">aes</span>(age), <span class="dt">alpha =</span> .<span class="dv">02</span>, <span class="dt">sides =</span> <span class="st">&quot;t&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Predicted probability of voting&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted probability of voting&quot;</span>,
       <span class="dt">color =</span> <span class="st">&quot;Spline&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</code></pre></div>
<p><img src="/notes/splines_files/figure-html/vote-age-natural-spline-1.png" width="672" /></p>
</div>
<div id="choosing-the-number-and-location-of-knots" class="section level2">
<h2><span class="header-section-number">2.5</span> Choosing the number and location of knots</h2>
<p>Typically knots are placed in a uniform fashion; that is, the cutpoints <span class="math inline">\(c\)</span> are determined by first identifying the number of knots <span class="math inline">\(K\)</span> for the model, then partitioning <span class="math inline">\(X\)</span> into uniform quantiles. So if we fit a cubic regression spline with 5 knots on the voting and age logistic regression, it would divide <code>age</code> into 5 equal quantiles<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> and estimate the cubic spline function for each quantile:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate model</span>
<span class="kw">glm</span>(vote96 <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">8</span>), <span class="dt">data =</span> mh, <span class="dt">family =</span> binomial) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cplot</span>(<span class="st">&quot;age&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;prediction&quot;</span>, <span class="dt">n =</span> <span class="dv">101</span>, <span class="dt">draw =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> xvals)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> yvals)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> upper), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> lower), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">attr</span>(<span class="kw">bs</span>(mh<span class="op">$</span>age, <span class="dt">df =</span> <span class="dv">8</span>), <span class="st">&quot;knots&quot;</span>),
             <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rug</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mh, vote96 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>), <span class="kw">aes</span>(age), <span class="dt">alpha =</span> .<span class="dv">02</span>, <span class="dt">sides =</span> <span class="st">&quot;b&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rug</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mh, vote96 <span class="op">==</span><span class="st"> </span><span class="dv">1</span>), <span class="kw">aes</span>(age), <span class="dt">alpha =</span> .<span class="dv">02</span>, <span class="dt">sides =</span> <span class="st">&quot;t&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Predicted probability of voting&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Natural spline with 5 knots&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted probability of voting&quot;</span>)</code></pre></div>
<pre><code>##    xvals     yvals     upper     lower
## 1  20.00 0.4365875 0.6152524 0.2579225
## 2  20.69 0.4349055 0.5858878 0.2839233
## 3  21.38 0.4335110 0.5594090 0.3076131
## 4  22.07 0.4326892 0.5375872 0.3277911
## 5  22.76 0.4327249 0.5223324 0.3431174
## 6  23.45 0.4339044 0.5150604 0.3527483
## 7  24.14 0.4365161 0.5155818 0.3574504
## 8  24.83 0.4408527 0.5218540 0.3598515
## 9  25.52 0.4472125 0.5312197 0.3632054
## 10 26.21 0.4558994 0.5415780 0.3702207
## 11 26.90 0.4672208 0.5517345 0.3827072
## 12 27.59 0.4813729 0.5615872 0.4011587
## 13 28.28 0.4978562 0.5725209 0.4231915
## 14 28.97 0.5158829 0.5866117 0.4451542
## 15 29.66 0.5346433 0.6052594 0.4640272
## 16 30.35 0.5533227 0.6276864 0.4789591
## 17 31.04 0.5711232 0.6509459 0.4913005
## 18 31.73 0.5872816 0.6714543 0.5031089
## 19 32.42 0.6010806 0.6861865 0.5159747
## 20 33.11 0.6118473 0.6932035 0.5304911</code></pre>
<p><img src="/notes/splines_files/figure-html/vote-spline-1.png" width="672" /></p>
<p>But this still leaves unaddressed the matter of how many knots should we use? Or how many degrees should each polynomial be? While theory should still be our guide, we can also use <a href="/notes/cross-validation/">cross-validation</a> to determine the optimal number of knots and/or polynomial degrees. For our voting and age model, we can estimate <span class="math inline">\(10\)</span>-fold CV MSE for varying numbers of knots for a cubic natural spline:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># function to simplify things</span>
vote_spline &lt;-<span class="st"> </span><span class="cf">function</span>(splits, <span class="dt">df =</span> <span class="ot">NULL</span>){
  <span class="co"># estimate the model on each fold</span>
  model &lt;-<span class="st"> </span><span class="kw">glm</span>(vote96 <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> df),
                <span class="dt">data =</span> <span class="kw">analysis</span>(splits))
  
  model_acc &lt;-<span class="st"> </span><span class="kw">augment</span>(model, <span class="dt">newdata =</span> <span class="kw">assessment</span>(splits)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">accuracy</span>(<span class="dt">truth =</span> <span class="kw">factor</span>(vote96), <span class="dt">estimate =</span> <span class="kw">factor</span>(<span class="kw">round</span>(.fitted)))
  
  <span class="kw">mean</span>(model_acc<span class="op">$</span>.estimate)
}

tune_over_knots &lt;-<span class="st"> </span><span class="cf">function</span>(splits, knots){
  <span class="kw">vote_spline</span>(splits, <span class="dt">df =</span> knots <span class="op">+</span><span class="st"> </span><span class="dv">3</span>)
}

<span class="co"># estimate CV error for knots in 0:25</span>
results &lt;-<span class="st"> </span><span class="kw">vfold_cv</span>(mh, <span class="dt">v =</span> <span class="dv">10</span>)

<span class="kw">expand</span>(results, id, <span class="dt">knots =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">25</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(results) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">acc =</span> <span class="kw">map2_dbl</span>(splits, knots, tune_over_knots)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(knots) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">acc =</span> <span class="kw">mean</span>(acc)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">err =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>acc) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(knots, err)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Optimal number of knots for natural cubic spline regression&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Knots&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;10-fold CV error&quot;</span>)</code></pre></div>
<pre><code>## Joining, by = &quot;id&quot;</code></pre>
<p><img src="/notes/splines_files/figure-html/vote-cv-1.png" width="672" /></p>
<p>These results (weakly) suggest the optimal number of knots is around 7. The resulting model produced by these parameters is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glm</span>(vote96 <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">10</span>), <span class="dt">data =</span> mh, <span class="dt">family =</span> binomial) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cplot</span>(<span class="st">&quot;age&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;prediction&quot;</span>, <span class="dt">n =</span> <span class="dv">101</span>, <span class="dt">draw =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> xvals)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> yvals)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> upper), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> lower), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">attr</span>(<span class="kw">bs</span>(mh<span class="op">$</span>age, <span class="dt">df =</span> <span class="dv">10</span>), <span class="st">&quot;knots&quot;</span>),
             <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rug</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mh, vote96 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>), <span class="kw">aes</span>(age), <span class="dt">alpha =</span> .<span class="dv">02</span>, <span class="dt">sides =</span> <span class="st">&quot;b&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rug</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mh, vote96 <span class="op">==</span><span class="st"> </span><span class="dv">1</span>), <span class="kw">aes</span>(age), <span class="dt">alpha =</span> .<span class="dv">02</span>, <span class="dt">sides =</span> <span class="st">&quot;t&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Predicted probability of voting&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Natural spline with 9 knots&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted probability of voting&quot;</span>)</code></pre></div>
<pre><code>##    xvals     yvals     upper     lower
## 1  20.00 0.4282471 0.6252063 0.2312880
## 2  20.69 0.4293039 0.5890076 0.2696002
## 3  21.38 0.4305556 0.5583606 0.3027506
## 4  22.07 0.4321971 0.5369902 0.3274039
## 5  22.76 0.4344240 0.5279673 0.3408806
## 6  23.45 0.4374334 0.5304412 0.3444256
## 7  24.14 0.4414241 0.5391198 0.3437284
## 8  24.83 0.4465971 0.5482488 0.3449455
## 9  25.52 0.4531559 0.5540876 0.3522242
## 10 26.21 0.4613048 0.5553154 0.3672942
## 11 26.90 0.4711676 0.5551890 0.3871463
## 12 27.59 0.4827288 0.5616053 0.4038523
## 13 28.28 0.4959521 0.5792913 0.4126129
## 14 28.97 0.5107901 0.6041743 0.4174059
## 15 29.66 0.5271801 0.6278985 0.4264617
## 16 30.35 0.5450170 0.6439796 0.4460544
## 17 31.04 0.5636486 0.6533090 0.4739883
## 18 31.73 0.5819142 0.6631953 0.5006332
## 19 32.42 0.5986776 0.6793978 0.5179575
## 20 33.11 0.6128695 0.6994918 0.5262471</code></pre>
<p><img src="/notes/splines_files/figure-html/vote-optimal-mod-1.png" width="672" /></p>
</div>
<div id="comparison-to-polynomial-regression" class="section level2">
<h2><span class="header-section-number">2.6</span> Comparison to polynomial regression</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate natural spline model with df = 15</span>
vote_age_spline &lt;-<span class="st"> </span><span class="kw">glm</span>(vote96 <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">15</span>), <span class="dt">data =</span> mh, <span class="dt">family =</span> binomial) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cplot</span>(<span class="st">&quot;age&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;prediction&quot;</span>, <span class="dt">n =</span> <span class="dv">101</span>, <span class="dt">draw =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##    xvals     yvals     upper     lower
## 1  20.00 0.3793679 0.5937175 0.1650183
## 2  20.69 0.4036169 0.5701519 0.2370819
## 3  21.38 0.4269748 0.5554718 0.2984778
## 4  22.07 0.4478904 0.5579094 0.3378715
## 5  22.76 0.4648086 0.5768161 0.3528010
## 6  23.45 0.4762154 0.5978715 0.3545592
## 7  24.14 0.4806509 0.6066536 0.3546482
## 8  24.83 0.4766980 0.5953759 0.3580200
## 9  25.52 0.4637043 0.5662287 0.3611799
## 10 26.21 0.4472652 0.5433292 0.3512012
## 11 26.90 0.4360408 0.5421729 0.3299086
## 12 27.59 0.4385613 0.5527483 0.3243743
## 13 28.28 0.4632700 0.5686895 0.3578505
## 14 28.97 0.5078890 0.6113495 0.4044285
## 15 29.66 0.5551993 0.6810660 0.4293325
## 16 30.35 0.5876407 0.7186129 0.4566685
## 17 31.04 0.6009741 0.7130297 0.4889185
## 18 31.73 0.6026509 0.7059829 0.4993189
## 19 32.42 0.6001666 0.7159611 0.4843721
## 20 33.11 0.6009303 0.7182665 0.4835942</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vote_age_poly &lt;-<span class="st"> </span><span class="kw">glm</span>(vote96 <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(age, <span class="dt">degree =</span> <span class="dv">15</span>), <span class="dt">data =</span> mh, <span class="dt">family =</span> binomial) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cplot</span>(<span class="st">&quot;age&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;prediction&quot;</span>, <span class="dt">n =</span> <span class="dv">101</span>, <span class="dt">draw =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##    xvals     yvals     upper       lower
## 1  20.00 0.3147316 0.6468989 -0.01743579
## 2  20.69 0.4336945 0.6230703  0.24431868
## 3  21.38 0.4661499 0.6331999  0.29909993
## 4  22.07 0.4622876 0.6096001  0.31497514
## 5  22.76 0.4500350 0.5924091  0.30766088
## 6  23.45 0.4408239 0.5808743  0.30077352
## 7  24.14 0.4376567 0.5674496  0.30786382
## 8  24.83 0.4400282 0.5547577  0.32529862
## 9  25.52 0.4464936 0.5488403  0.34414683
## 10 26.21 0.4557857 0.5521246  0.35944689
## 11 26.90 0.4671423 0.5615938  0.37269092
## 12 27.59 0.4802441 0.5731831  0.38730502
## 13 28.28 0.4949974 0.5854407  0.40455399
## 14 28.97 0.5113020 0.5991466  0.42345751
## 15 29.66 0.5288806 0.6152420  0.44251919
## 16 30.35 0.5472025 0.6332668  0.46113821
## 17 31.04 0.5655059 0.6513874  0.47962443
## 18 31.73 0.5828948 0.6675462  0.49824339
## 19 32.42 0.5984739 0.6804517  0.51649598
## 20 33.11 0.6114804 0.6898582  0.53310260</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bind_rows</span>(
  <span class="st">`</span><span class="dt">Natural cubic spline</span><span class="st">`</span> =<span class="st"> </span>vote_age_spline,
  <span class="st">`</span><span class="dt">Polynomial</span><span class="st">`</span> =<span class="st"> </span>vote_age_poly,
  <span class="dt">.id =</span> <span class="st">&quot;model&quot;</span>
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> xvals)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> yvals, <span class="dt">color =</span> model)) <span class="op">+</span>
<span class="st">  </span><span class="co"># geom_line(aes(y = upper, color = model), linetype = 2) +</span>
<span class="st">  </span><span class="co"># geom_line(aes(y = lower, color = model), linetype = 2) +</span>
<span class="st">  </span><span class="co"># geom_hline(yintercept = 0, linetype = 1) +</span>
<span class="st">  </span><span class="kw">geom_rug</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mh, vote96 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>), <span class="kw">aes</span>(age), <span class="dt">alpha =</span> .<span class="dv">02</span>, <span class="dt">sides =</span> <span class="st">&quot;b&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rug</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mh, vote96 <span class="op">==</span><span class="st"> </span><span class="dv">1</span>), <span class="kw">aes</span>(age), <span class="dt">alpha =</span> .<span class="dv">02</span>, <span class="dt">sides =</span> <span class="st">&quot;t&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Predicted probability of voting&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted probability of voting&quot;</span>,
       <span class="dt">color =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</code></pre></div>
<p><img src="/notes/splines_files/figure-html/vote-spline-poly-1.png" width="672" /></p>
<p>Splines are generally superior to polynomial regression because their flexibility is defined primarily in terms of the number of knots in the model, rather than the degree of the highest polynomial term (e.g. <span class="math inline">\(X^{15}\)</span>), whereas polynomial regression models must use high degree polynomials to achieve similar flexibility. This leads to more overfitting and wilder behavior, especially in the boundary regions. In the comparison above, we fit a natural cubic spline with 15 degrees of freedom (aka 12 knots) and compare it to a degree-15 polynomial regression. Notice the undesirable behavior of the polynomial regression model at the boundaries relative to the natural cubic spline.</p>
</div>
</div>
<div id="smoothing-splines" class="section level1">
<h1><span class="header-section-number">3</span> Smoothing splines</h1>
<p><strong>Smoothing splines</strong> take a different approach to producing a spline. The goal is to fit a function <span class="math inline">\(g(x)\)</span> to the observed data well; that is,</p>
<p><span class="math display">\[\min \left\{ \text{RSS} = \sum_{i=1}^n (y_i - g(x_i))^2 \right\}\]</span></p>
<p>With no constraints, we could generate a function that interpolates all of the <span class="math inline">\(y_i\)</span>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_spline_data &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">100</span>, <span class="dt">min =</span> <span class="op">-</span><span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">1</span>),
  <span class="dt">y =</span> <span class="kw">poly</span>(x, <span class="dt">degree =</span> <span class="dv">15</span>, <span class="dt">raw =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">rowSums</span>() <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>)
)

<span class="kw">ggplot</span>(sim_spline_data, <span class="kw">aes</span>(x, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(X),
       <span class="dt">y =</span> <span class="kw">expression</span>(Y))</code></pre></div>
<p><img src="/notes/splines_files/figure-html/sim-perfect-fit-1.png" width="672" /></p>
<p>Clearly such a function would overfit the data. Instead, we want a function <span class="math inline">\(g\)</span> that makes <span class="math inline">\(\text{RSS}\)</span> small, but that is also smooth.</p>
<p>The approach of a smoothing spline is to find the function that minimizes</p>
<p><span class="math display">\[\sum_{i=1}^n (y_i - g(x_i))^2 + \lambda \int g&#39;&#39;(t)^2 dt\]</span></p>
<p>where <span class="math inline">\(\lambda\)</span> is a non-negative tuning parameter. The function that <span class="math inline">\(g\)</span> minimizes is the smoothing spline.</p>
<p>This is the same “Loss + Penalty” form that we used for <a href="/syllabus/selection-regulation/">ridge/lasso/elastic net regression</a>. The second derivative of the function <span class="math inline">\(g(t)\)</span> is a measure of the function’s <strong>roughness</strong>: it is large in absolute value if <span class="math inline">\(g(t)\)</span> is wiggly, and it is close to zero otherwise. By integrating over <span class="math inline">\(g&#39;&#39;(t)^2\)</span>, we capture the total change in <span class="math inline">\(g&#39;(t)\)</span>.</p>
<p>Including this as a weighted penalty forces <span class="math inline">\(g(x)\)</span> to impose smooth constraints. Otherwise the function is not minimized appropriately. As <span class="math inline">\(\lambda\)</span> increases, <span class="math inline">\(g\)</span> will become more smooth. When <span class="math inline">\(\lambda = 0\)</span>, <span class="math inline">\(g(x)\)</span> is a line that perfectly interpolates the original data points. When <span class="math inline">\(\lambda \rightarrow \infty\)</span>, <span class="math inline">\(g\)</span> will be perfectly smooth - it will just be a straight line that passes closely to the training points. In fact, it will be the linear least squares fit line.</p>
<p>What does this function look like?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># smooth spline data points</span>
sim_smooth &lt;-<span class="st"> </span><span class="kw">smooth.spline</span>(sim_spline_data<span class="op">$</span>x, sim_spline_data<span class="op">$</span>y, <span class="dt">df =</span> <span class="dv">6</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>predict <span class="op">%&gt;%</span>
<span class="st">  </span>as_tibble

<span class="kw">ggplot</span>(sim_spline_data, <span class="kw">aes</span>(x, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Cubic spline&quot;</span>),
              <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(x, <span class="dt">df =</span> <span class="dv">6</span>), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Natural spline&quot;</span>),
              <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(x, <span class="dt">df =</span> <span class="dv">6</span>), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> sim_smooth, <span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Smoothing spline&quot;</span>), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(X),
       <span class="dt">y =</span> <span class="kw">expression</span>(Y),
       <span class="dt">color =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</code></pre></div>
<p><img src="/notes/splines_files/figure-html/sim-spline-compare-1.png" width="672" /></p>
<p>A smoothing spline is strongly related to a natural cubic spline, with a couple notable exceptions. First, <span class="math inline">\(g(x)\)</span> is a natural cubic spline with knots at <span class="math inline">\(x_1, \ldots, x_n\)</span>. That is, there is a knot at every observed value of <span class="math inline">\(X\)</span>. Second, it is a <strong>shrunken</strong> version where the value of <span class="math inline">\(\lambda\)</span> controls the level of shrinkage.</p>
<div id="choosing-the-smoothing-parameter-lambda" class="section level2">
<h2><span class="header-section-number">3.1</span> Choosing the smoothing parameter <span class="math inline">\(\lambda\)</span></h2>
<p>One concern with smoothing splines is the number of degrees of freedom. With <span class="math inline">\(K = n\)</span> knots, we seem to need <span class="math inline">\(n + 4\)</span> degrees of freedom. For a linear regression model, that is not possible.</p>
<p>However, since the tuning parameter <span class="math inline">\(\lambda\)</span> dictates the roughness of the smoothing spline, it also controls the <strong>effective degrees of freedom</strong>. As <span class="math inline">\(\lambda\)</span> increases from <span class="math inline">\(0\)</span> to <span class="math inline">\(\infty\)</span>, the effective degrees of freedom decreases from <span class="math inline">\(n\)</span> to <span class="math inline">\(2\)</span>.</p>
<p>Degrees of freedom refer to the number of free parameters in a model, such as the number of coefficients fit in a regression model. Since a smoothing spline has <span class="math inline">\(n\)</span> parameters but each parameter is constrained by the penalty component of the loss function, they don’t carry the same value as a normal parameter. <span class="math inline">\(df_\lambda\)</span> is a measure of the flexibility of the smoothing spline, based on effectively how many degrees of freedom the model consumes. We can write this as</p>
<p><span class="math display">\[\hat{\mathbf{g}}_\lambda = \mathbf{S}_\lambda \mathbf{y}\]</span></p>
<p>where <span class="math inline">\(\hat{\mathbf{g}}_\lambda\)</span> is the solution to</p>
<p><span class="math display">\[\sum_{i=1}^n (y_i - g(x_i))^2 + \lambda \int g&#39;&#39;(t)^2 dt\]</span></p>
<p>for a particular choice of <span class="math inline">\(\lambda\)</span>. This vector of values can be written as an <span class="math inline">\(n \times n\)</span> matrix <span class="math inline">\(\mathbf{S}_\lambda\)</span> times the response vector <span class="math inline">\(\mathbf{y}\)</span>.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> The effective degrees of freedom is defined as</p>
<p><span class="math display">\[df_\lambda = \sum_{i=1}^n \{\mathbf{S}_\lambda \}_{ii}\]</span></p>
<p>We do not have to tune the number or location of knots for a smoothing spline - they exist at each <span class="math inline">\(x_1, \ldots, x_n\)</span>. We do need to choose a value for <span class="math inline">\(\lambda\)</span>. We can use cross-validation to determine which value of <span class="math inline">\(\lambda\)</span> generates the smallest test RSS/MSE. However, this can be computationally intensive. Instead, we can use an analytical short-cut for <a href="/notes/cross-validation/#leave-one-out-cross-validation">LOOCV</a>. This short-cut allows us to estimate a single model using the formula</p>
<p><span class="math display">\[\text{RSS}_{cv}(\lambda) = \sum_{i=1}^n (y_i - \hat{g}_\lambda^{(-i)} (x_i))^2 = \sum_{i=1}^n \left[ \frac{y_i - \hat{g}_\lambda (x_i)}{1 - \{ \mathbf{S}_\lambda \}_{ii}} \right]^2\]</span></p>
<ul>
<li><span class="math inline">\(\hat{g}_\lambda^{(-i)} (x_i)\)</span> - fitted value for a smoothing spline evaluated at <span class="math inline">\(x_i\)</span>, fit using all the training observations except the <span class="math inline">\(i\)</span>th observation</li>
<li><span class="math inline">\(\hat{g}_\lambda (x_i)\)</span> - fitted value for a smoothing spline evaluated at <span class="math inline">\(x_i\)</span>, fit using all the training observations</li>
</ul>
<p>To compute the LOOCV fits, we only need to use <span class="math inline">\(\hat{g}_\lambda\)</span>, which is the original model. In truth, most functions use the same approach for LOOCV for all least squares regression model.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></p>
<p>Compare the difference between effective degrees of freedom:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">list</span>(
  <span class="st">`</span><span class="dt">50</span><span class="st">`</span> =<span class="st"> </span><span class="kw">smooth.spline</span>(sim_spline_data<span class="op">$</span>x, sim_spline_data<span class="op">$</span>y, <span class="dt">df =</span> <span class="dv">50</span>),
  <span class="st">`</span><span class="dt">20</span><span class="st">`</span> =<span class="st"> </span><span class="kw">smooth.spline</span>(sim_spline_data<span class="op">$</span>x, sim_spline_data<span class="op">$</span>y, <span class="dt">df =</span> <span class="dv">20</span>),
  <span class="st">`</span><span class="dt">2</span><span class="st">`</span> =<span class="st"> </span><span class="kw">smooth.spline</span>(sim_spline_data<span class="op">$</span>x, sim_spline_data<span class="op">$</span>y, <span class="dt">df =</span> <span class="dv">2</span>),
  <span class="st">`</span><span class="dt">11</span><span class="st">`</span> =<span class="st"> </span><span class="kw">smooth.spline</span>(sim_spline_data<span class="op">$</span>x, sim_spline_data<span class="op">$</span>y)
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map_df</span>(predict, <span class="dt">.id =</span> <span class="st">&quot;df&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">df =</span> <span class="kw">factor</span>(df, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">11</span>, <span class="dv">20</span>, <span class="dv">50</span>),
                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;11 (CV)&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;50&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> sim_spline_data, <span class="dt">alpha =</span> .<span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> df)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;Dark2&quot;</span>, <span class="dt">guide =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>df) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Effective degrees of freedom&quot;</span>,
       <span class="dt">x =</span> <span class="kw">expression</span>(X),
       <span class="dt">y =</span> <span class="kw">expression</span>(Y))</code></pre></div>
<p><img src="/notes/splines_files/figure-html/sim-smooth-spline-compare-1.png" width="672" /></p>
</div>
</div>
<div id="session-info" class="section level1 toc-ignore">
<h1><span class="header-section-number">4</span> Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw">session_info</span>()</code></pre></div>
<pre><code>## ─ Session info ──────────────────────────────────────────────────────────
##  setting  value                       
##  version  R version 3.5.2 (2018-12-20)
##  os       macOS Mojave 10.14.2        
##  system   x86_64, darwin15.6.0        
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  ctype    en_US.UTF-8                 
##  tz       America/Chicago             
##  date     2019-02-19                  
## 
## ─ Packages ──────────────────────────────────────────────────────────────
##  package       * version    date       lib
##  assertthat      0.2.0      2017-04-11 [2]
##  backports       1.1.3      2018-12-14 [2]
##  base64enc       0.1-3      2015-07-28 [2]
##  bayesplot       1.6.0      2018-08-02 [2]
##  bindr           0.1.1      2018-03-13 [2]
##  bindrcpp        0.2.2      2018-03-29 [1]
##  blogdown        0.10       2019-01-09 [1]
##  bookdown        0.9        2018-12-21 [1]
##  broom         * 0.5.1      2018-12-05 [2]
##  callr           3.1.1      2018-12-21 [2]
##  cellranger      1.1.0      2016-07-27 [2]
##  class           7.3-15     2019-01-01 [2]
##  cli             1.0.1      2018-09-25 [1]
##  codetools       0.2-16     2018-12-24 [2]
##  colorspace      1.4-0      2019-01-13 [2]
##  colourpicker    1.0        2017-09-27 [2]
##  crayon          1.3.4      2017-09-16 [2]
##  crosstalk       1.0.0      2016-12-21 [2]
##  data.table      1.12.0     2019-01-13 [2]
##  desc            1.2.0      2018-05-01 [2]
##  devtools        2.0.1      2018-10-26 [1]
##  dials         * 0.0.2      2018-12-09 [1]
##  digest          0.6.18     2018-10-10 [1]
##  dplyr         * 0.7.8      2018-11-10 [1]
##  DT              0.5        2018-11-05 [2]
##  dygraphs        1.1.1.6    2018-07-11 [2]
##  earth         * 4.7.0      2019-01-03 [1]
##  evaluate        0.12       2018-10-09 [2]
##  forcats       * 0.3.0      2018-02-19 [2]
##  foreach       * 1.4.4      2017-12-12 [2]
##  fs              1.2.6      2018-08-23 [1]
##  gam           * 1.16       2018-07-20 [2]
##  generics        0.0.2      2018-11-29 [1]
##  ggplot2       * 3.1.0      2018-10-25 [1]
##  ggridges        0.5.1      2018-09-27 [2]
##  glue            1.3.0      2018-07-17 [2]
##  gower           0.1.2      2017-02-23 [2]
##  gridExtra       2.3        2017-09-09 [2]
##  gtable          0.2.0      2016-02-26 [2]
##  gtools          3.8.1      2018-06-26 [2]
##  haven           2.0.0      2018-11-22 [2]
##  here          * 0.1        2017-05-28 [2]
##  hms             0.4.2      2018-03-10 [2]
##  htmltools       0.3.6      2017-04-28 [1]
##  htmlwidgets     1.3        2018-09-30 [2]
##  httpuv          1.4.5.1    2018-12-18 [2]
##  httr            1.4.0      2018-12-11 [2]
##  igraph          1.2.2      2018-07-27 [2]
##  infer         * 0.4.0      2018-11-15 [1]
##  inline          0.3.15     2018-05-18 [2]
##  ipred           0.9-8      2018-11-05 [1]
##  ISLR          * 1.2        2017-10-20 [2]
##  iterators       1.0.10     2018-07-13 [2]
##  janeaustenr     0.1.5      2017-06-10 [2]
##  jsonlite        1.6        2018-12-07 [2]
##  knitr         * 1.21       2018-12-10 [2]
##  later           0.7.5      2018-09-18 [2]
##  lattice       * 0.20-38    2018-11-04 [2]
##  lava            1.6.4      2018-11-25 [2]
##  lazyeval        0.2.1      2017-10-29 [2]
##  lme4            1.1-19     2018-11-10 [2]
##  loo             2.0.0      2018-04-11 [2]
##  lubridate       1.7.4      2018-04-11 [2]
##  magrittr        1.5        2014-11-22 [2]
##  margins       * 0.3.23     2018-05-22 [2]
##  markdown        0.9        2018-12-07 [2]
##  MASS            7.3-51.1   2018-11-01 [2]
##  Matrix          1.2-15     2018-11-01 [2]
##  matrixStats     0.54.0     2018-07-23 [2]
##  memoise         1.1.0      2017-04-21 [2]
##  mime            0.6        2018-10-05 [1]
##  miniUI          0.1.1.1    2018-05-18 [2]
##  minqa           1.2.4      2014-10-09 [2]
##  modelr          0.1.2      2018-05-11 [2]
##  munsell         0.5.0      2018-06-12 [2]
##  nlme            3.1-137    2018-04-07 [2]
##  nloptr          1.2.1      2018-10-03 [2]
##  nnet            7.3-12     2016-02-02 [2]
##  parsnip       * 0.0.1      2018-11-12 [1]
##  patchwork     * 0.0.1      2018-09-06 [1]
##  pillar          1.3.1      2018-12-15 [2]
##  pkgbuild        1.0.2      2018-10-16 [1]
##  pkgconfig       2.0.2      2018-08-16 [2]
##  pkgload         1.0.2      2018-10-29 [1]
##  plotmo        * 3.5.2      2019-01-02 [1]
##  plotrix       * 3.7-4      2018-10-03 [2]
##  plyr            1.8.4      2016-06-08 [2]
##  prediction      0.3.6.1    2018-12-04 [2]
##  prettyunits     1.0.2      2015-07-13 [2]
##  pROC            1.13.0     2018-09-24 [1]
##  processx        3.2.1      2018-12-05 [2]
##  prodlim         2018.04.18 2018-04-18 [2]
##  promises        1.0.1      2018-04-13 [2]
##  ps              1.3.0      2018-12-21 [2]
##  purrr         * 0.3.0      2019-01-27 [2]
##  R6              2.3.0      2018-10-04 [1]
##  rcfss         * 0.1.5      2019-01-24 [1]
##  Rcpp            1.0.0      2018-11-07 [1]
##  readr         * 1.3.1      2018-12-21 [2]
##  readxl          1.2.0      2018-12-19 [2]
##  recipes       * 0.1.4      2018-11-19 [1]
##  remotes         2.0.2      2018-10-30 [1]
##  reshape2        1.4.3      2017-12-11 [2]
##  rlang           0.3.1      2019-01-08 [1]
##  rmarkdown       1.11       2018-12-08 [2]
##  rpart           4.1-13     2018-02-23 [1]
##  rprojroot       1.3-2      2018-01-03 [2]
##  rsample       * 0.0.4      2019-01-07 [1]
##  rsconnect       0.8.13     2019-01-10 [2]
##  rstan           2.18.2     2018-11-07 [2]
##  rstanarm        2.18.2     2018-11-10 [2]
##  rstantools      1.5.1      2018-08-22 [2]
##  rstudioapi      0.9.0      2019-01-09 [1]
##  rvest           0.3.2      2016-06-17 [2]
##  scales        * 1.0.0      2018-08-09 [1]
##  sessioninfo     1.1.1      2018-11-05 [1]
##  shiny           1.2.0      2018-11-02 [2]
##  shinyjs         1.0        2018-01-08 [2]
##  shinystan       2.5.0      2018-05-01 [2]
##  shinythemes     1.1.2      2018-11-06 [2]
##  SnowballC       0.6.0      2019-01-15 [2]
##  StanHeaders     2.18.0-1   2018-12-13 [2]
##  stringi         1.2.4      2018-07-20 [2]
##  stringr       * 1.3.1      2018-05-10 [2]
##  survival        2.43-3     2018-11-26 [2]
##  TeachingDemos * 2.10       2016-02-12 [2]
##  testthat        2.0.1      2018-10-13 [2]
##  threejs         0.3.1      2017-08-13 [2]
##  tibble        * 2.0.1      2019-01-12 [2]
##  tidymodels    * 0.0.2      2018-11-27 [1]
##  tidyposterior   0.0.2      2018-11-15 [1]
##  tidypredict     0.3.0      2019-01-10 [1]
##  tidyr         * 0.8.2.9000 2019-02-11 [1]
##  tidyselect      0.2.5      2018-10-11 [1]
##  tidytext        0.2.0      2018-10-17 [1]
##  tidyverse     * 1.2.1      2017-11-14 [2]
##  timeDate        3043.102   2018-02-21 [2]
##  titanic       * 0.1.0      2015-08-31 [2]
##  tokenizers      0.2.1      2018-03-29 [2]
##  usethis         1.4.0      2018-08-14 [1]
##  withr           2.1.2      2018-03-15 [2]
##  xfun            0.4        2018-10-23 [1]
##  xml2            1.2.0      2018-01-24 [2]
##  xtable          1.8-3      2018-08-29 [2]
##  xts             0.11-2     2018-11-05 [2]
##  yaml            2.2.0      2018-07-25 [2]
##  yardstick     * 0.0.2      2018-11-05 [1]
##  zoo             1.8-4      2018-09-19 [2]
##  source                              
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.1)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.1)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.1)                      
##  Github (thomasp85/patchwork@7fb35b1)
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.1)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  local                               
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  CRAN (R 3.5.1)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.2)                      
##  Github (tidyverse/tidyr@0b27690)    
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
##  CRAN (R 3.5.0)                      
## 
## [1] /Users/soltoffbc/Library/R/3.5/library
## [2] /Library/Frameworks/R.framework/Versions/3.5/Resources/library</code></pre>
</div>
<div id="references" class="section level1 toc-ignore">
<h1><span class="header-section-number">5</span> References</h1>
<ul>
<li><span class="citation">James et al. (<a href="#ref-james2013introduction">2013</a>)</span></li>
<li><span class="citation">Friedman, Hastie, and Tibshirani (<a href="#ref-friedman2001elements">2001</a>)</span></li>
</ul>
<div id="refs" class="references">
<div id="ref-friedman2001elements">
<p>Friedman, Jerome, Trevor Hastie, and Robert Tibshirani. 2001. <em>The Elements of Statistical Learning</em>. Vol. 1. 10. Springer series in statistics New York, NY, USA: <a href="https://web.stanford.edu/~hastie/ElemStatLearn/" class="uri">https://web.stanford.edu/~hastie/ElemStatLearn/</a>.</p>
</div>
<div id="ref-james2013introduction">
<p>James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2013. <em>An Introduction to Statistical Learning</em>. Vol. 112. Springer. <a href="http://www-bcf.usc.edu/~gareth/ISL/" class="uri">http://www-bcf.usc.edu/~gareth/ISL/</a>.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>That is, each interval contains the same number of observations rather than each interval having an equal width.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>See ESL ch 5.4.1 for the technical definition of <span class="math inline">\(\mathbf{S}_\lambda\)</span>.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>This trick does not work for GLMs or related modeling strategies.<a href="#fnref3">↩</a></p></li>
</ol>
</div>
